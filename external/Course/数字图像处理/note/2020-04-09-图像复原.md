---
title: 图像复原
tags: 数字图像处理
article_header:
  type: cover
  image:
    src: /assets/images/DIP.jpg
---

<!--more-->

## 图像退化/复原过程的模型

图像在形成、记录、处理和传输过程中，由于成像系统、记录设备、传输介质和处理方法的不完善，导致图像质量下降，称为图像退化

图像质量下降可能的表现包括：畸变、模糊、失真或混入噪声等

图像退化的具体原因包括：

* 成像系统的像差、畸变、带宽有限等造成图像失真
* 成像器件拍摄姿态和扫描非线性引起的图像几何失真
* 成像系统与目标景物之间的相对运动，引起的图像运动模糊
* 光学系统或成像器件本身响应特性的不均匀，造成的灰度失真
* 由于场景能量传输通道中的介质特性如大气湍流效应、大气成分变化引起的图像辐射失真
* 图像在成像、数字化、采集和处理过程中引入的噪声

图像复原是试图利用退化过程的先验知识使已退化的图像恢复本来面目，即根据退化的原因，分析引起退化的环境因素，建立相应的数学模型，并沿着使图像降质的逆过程恢复图像，目的在于消除或减轻在图像获取以及传输过程中造成的图像品质下降，恢复图像的本来面目

图像复原和图像增强的区别：

* 图像增强不考虑图像是如何退化的**，**而是一个探索性过程**，**试图采用各种技术来增强图像的视觉效果。因此，图像增强可以不顾增强后的图像是否失真，只要看得舒服就行。
* 图像复原就完全不同，需知道图像退化的机制和过程等先验知识，据此找出一种相应的逆处理方法，从而得到复原的图像。图像复原通常会涉及到设立一个最佳准则，它将会产生期望的最佳估计。
* 如果图像已退化，应先作复原处理，再作增强处理。 
* 二者的目的都是为了改善图像的质量。

图像复原技术的分类：

* 无约束和有约束
	* 设定一个条件，来定义什么是接近真实；或者来衡量接近真实的程度

* 自动和交互
	* 是否需要人的参与
* 频域和空域

图像退化/复原模型

* 图像复原的关键在于建立图像退化模型，图像的退化模型反映图像退化的原因。

* 通常将退化原因作为线性、空间不变系统来考虑，从而建立系统退化模型来近似描述图像函数的退化

![image-20200409100526913](图像复原.assets/image-20200409100526913.png)

退化过程可以被模型化为一个退化函数和一个加性噪声项，作用于输入图像$f(x,y)$产生一幅退化图像$g(x,y)$，给定$g(x,y)$核关于退化函数$H$的一些知识以及外加噪声项$\eta(x,y)$，图像复原的目的是获得关于原始图像的近似估计$\hat{f}(x,y)$

## 图像噪声的空间和频率特性

数字图像的噪声主要来源于图像的获取（数字化过程）和传输过程

噪声的空间和频率特性：

* 频率特性：噪声在傅里叶变换域的频率特性

* 空间特性：噪声与空间坐标的关系（除周期噪声以外，本章中假设噪声独立于空间坐标，并且它与图像内容无关联）

空间噪声利用退化模型中噪声分量的灰度值统计特性来表示**，**可以被认为是由概率密度函数（PDF）表示的随机变量

*高斯随机变量*

<img src="图像复原.assets/image-20200409101132653.png" alt="image-20200409101132653" style="zoom: 67%;" />
$$
p(z)=\frac{1}{\sqrt{2\pi\sigma}}e^{-(z-\mu)^2/2\sigma^2}
$$
其中$z$表示灰度值，$\mu$表示$z$的平均值或期望值，$\sigma$表示$z$的标准差

当$z$服从高斯分布时，其值70%落在$[(\mu-\sigma),(\mu+\sigma)]$范围内，且有95%落在$[(\mu-2\sigma),\mu+2\sigma]$范围内

*瑞利噪声*

<img src="图像复原.assets/image-20200409101529560.png" alt="image-20200409101529560" style="zoom:67%;" />
$$
p(z)=\begin{cases}\frac{2}{b}(z-a)e^{-(z-a)^2/b}&z\geq a\\
0&z<a\end{cases}
$$
概率密度的均值和方差由下式给定：
$$
\mu=a+\sqrt{\pi b/4}\\
\sigma^2=\frac{b(4-\pi)}{4}
$$
瑞利密度对于近似偏移的直方图十分适用，当一个随机二维向量的两个分量呈独立的、有着相同的方差的正态分布时，这个向量的模呈瑞利分布

*伽马噪声*

<img src="图像复原.assets/image-20200409101758999.png" alt="image-20200409101758999" style="zoom:67%;" />
$$
p(z)=\begin{cases}
\frac{a^bz^{b-1}}{(b-1)!}e^{-az}&z\geq 0\\
0&z<0
\end{cases}
$$
其中，$a>0$，$b$为正整数

概率密度的均值和方差由下式给定：
$$
\mu=\frac{b}{a}\\
\sigma^2=\frac{b}{a^2}
$$
*均匀分布噪声*

<img src="图像复原.assets/image-20200409103110118.png" alt="image-20200409103110118" style="zoom:67%;" />
$$
p(z)=
\begin{cases}
\frac{1}{b-1}&a\leq  z\leq b\\
0&其他
\end{cases}
$$
概率密度的均值和方差由下式给定：
$$
\mu=\frac{a+b}{2}\\
\sigma^2=\frac{(b-a)^2}{12}
$$
*脉冲噪声*

<img src="图像复原.assets/image-20200409103634222.png" alt="image-20200409103634222" style="zoom:67%;" />
$$
p(z)=
\begin{cases}
P_a&z=a\\
P_b&z=b\\
0&其他
\end{cases}
$$
若$b>a$，灰度值$b$将显示为一个亮点，$a$的值将显示为一个暗点，若$P_a$或$P_b$为零，则脉冲噪声称为单极脉冲

若$P_a$或$P_b$均不可能为零，尤其是近似相等时，脉冲噪声值类似于随机分布在图像上的胡椒和盐粉细粒

噪声PDF测试结论：

* 除了椒盐噪声，很难从图像的视觉效果上分辨出噪声的类型
* 只有通过直方图的形状，能够较好地分辨出不同的噪声类型
* 实际的图像噪声类型的判断更加困难

噪声与来源的大致对应：

* 高斯噪声**：**电子电路噪声**、**低照明度和/或高温带来的传感器噪声
* 瑞利噪声：表征深度成像中的噪声
* 指数和伽马噪声：在激光成像中有用
* 均匀噪声：仿真（随机数发生器）

周期噪声：

* 图像中与空间位置相关的周期性干扰
* 一般为成像器件、电路系统（电力或机电干扰）或机械系统引入的噪声
* 唯一 一种空间依赖型噪声
* 周期噪声可以通过频率域滤波显著减少

## 图像噪声参数的估计

* 周期噪声的参数可以通过检测图像的傅里叶谱来进行估计
* 噪声PDF的参数一般可以从图像传感器的技术说明中得到
* 对于特殊的成像装置，可拍摄特定的测试图像来估计
* 当只有传感器产生的图像可用时，只能从恒定灰度值的一小部分图像估计PDF的参数
* 利用垂直条带（150\*20pixels）估计PDF参数

![image-20200409111146466](图像复原.assets/image-20200409111146466.png)

<img src="图像复原.assets/image-20200409111018993.png" alt="image-20200409111018993" style="zoom:67%;" />

## 噪声图像的滤波复原

当一幅图像中唯一存在的退化是噪声时：
$$
g(x,y)=f(x,y)+\eta(x,y)
$$
和
$$
G(x,y)=F(u,v)+N(u,v)
$$

* 噪声项是未知的
* 当仅有加性噪声存在时，可以选择空间滤波方法
* 这一特殊情况下，图像的增强和复原几乎不可区别

### 均值滤波器

**算术均值滤波器**

令$S_{xy}$表示中心在$(x,y)$点，尺寸为$m\times n$的矩形子图像窗口的坐标组，算术均值滤波的过程就是计算由$S_{xy}$定义的区域中被干扰图像$g(x,y)$的平均值
$$
\hat{f} (x,y)=\frac{1}{mn}\sum\limits_{(s,t)\in S_{xy}}g(s,t)
$$
这个操作可以用系数为$\frac{1}{mn}$的卷积模板来实现

**几何均值滤波器**
$$
\hat f(x,y)=\Bigg[\prod_{(s,t)\in S_{xy}}g(s,t) \Bigg]^{\frac{1}{mn}}
$$
**谐波均值滤波器**
$$
\hat f(x,y)=\frac{mn}{\sum\limits_{(s,t)\in S_{xy}}\frac{1}{g(s,t)}}
$$
**逆谐波均值滤波器**
$$
\hat f(x,y)=\frac{\sum\limits_{(s,t)\in S_{xy}}g(s,t)^{Q+1}}{\sum\limits_{(s,t)\in S_{xy}}g(s,t)^{Q}}
$$

* $Q$称为滤波器的阶数
	* 当$Q$为正数时，滤波器用于消除”胡椒“噪声
	* 当$Q$为负值时，滤波器用于消除”盐“噪声
	* 当$Q=0$时，逆谐波均值滤波器退化为算术均值滤波器
	* 当$Q=-1$时，逆谐波均值滤波器退化为谐波均值滤波器

*均值滤波器效果分析*

* 算术均值和几何均值都能衰减噪声，但比较而言，几何均值滤波器不易使图像变模糊
* 算术和几何适合处理高斯或均匀等随机噪声**，**谐波更适于处理脉冲噪声**，**但必须知道是暗噪声还是亮噪声，以便选择$Q$值符号

### 统计排序滤波器

**顺序统计滤波器**

* 中值滤波
	$$
	\hat f(x,y)=\mathop{\mathrm{median}}\limits_{(s,t)\in S_{xy}}\{g(s,t)\}
	$$

* 最大值滤波

$$
\hat f(x,y)=\mathop{\mathrm{max}}\limits_{(s,t)\in S_{xy}}\{g(s,t)\}
$$

* 最小值滤波

$$
\hat f(x,y)=\mathop{\mathrm{min}}\limits_{(s,t)\in S_{xy}}\{g(s,t)\}
$$

中点滤波器
* 在滤波器设计范围内计算最大值和最小值之间的中点
	$$
	\hat f(x,y)=\frac{1}{2}\Big[\mathop{\mathrm{max}}\limits_{(s,t)\in S_{xy}}\{g(s,t)\}+\mathop{\mathrm{min}}\limits_{(s,t)\in S_{xy}}\{g(s,t)\}  \Big]
	$$

* 这种滤波器结合了顺序统计和求平均，对于高斯和均匀随机分布这类噪声有最好的效果

修正的$\alpha$均值滤波器

* 假设在$S_{xy}$领域内去掉$g(s,t)$中$d/2$个最高灰度值和$d/2$个最低灰度值的像素。用$g_r(s,t)$来代替剩余的$mn-d$个像素。由这剩余像素点的平均值形成的滤波器称为修正后的$\alpha$均值滤波器
	$$
	\hat f(x,y)=\frac{1}{mn-d}\sum\limits_{(s,t)\in S_{xy}}g_r(s,t),0\leq d\leq mn-1
	$$

	* 当$d=0$时，修正的$\alpha$均值滤波器退化为算术均值滤波器
	* 当$d=(mn-1)/2$，修正的$\alpha$均值滤波器退化为中点滤波器
	* $d$取其他值时，修正的$\alpha$均值滤波器在包括多种噪声的情况下非常适用，如高斯噪声和椒盐噪声混合的情况下

*统计排序滤波器效果分析*

* 经过多次中值滤波处理，可逐渐消除噪声，但多次应用中值滤波器，会使图像模糊
* 最大值滤波器可以去除“胡椒”噪声，但会从黑色物体边缘移走一些黑色像素
* 最小值滤波器可以去除“盐”噪声，但会从亮色物体边缘移走一些白色像素

* 由于脉冲噪声的存在，算术均值滤波器和几何均值滤波器没有起到良好作用
* 中值滤波器和修正的阿尔法均值滤波器效果更好

### 自适应滤波器

**自适应局部降低噪声滤波器**

符号定义：

* $g(x,y)\rightarrow$ 表示噪声图像在点$(x,y)$上的值
* $\sigma_\eta^2\rightarrow$ 污染$f(x,y)$以形成$g(x,y)$的噪声方差
* $m_L\rightarrow$ 在$S_{xy}$上像素点的局部均值
* $\sigma_L^2\rightarrow$ 在$S_{xy}$上像素点的局部方差

滤波器的预期性能如下：

* 如果$\sigma_\eta^2=0$，滤波器应该简单地返回$g(x,y)$地值
* 如果$\sigma_L^2>\sigma_\eta^2$，那么滤波器要返回一个接近$g(x,y)$地值
* 如果$\sigma_L^2=\sigma_\eta^2$，希望滤波器返回区域$S_{xy}$上像素地平均值

自适应表达式：
$$
f(x,y)=g(x,y)-\frac{\sigma_\eta^2}{\sigma_L^2}[g(x,y)-m_L]
$$

* $\sigma_\eta^2$需要估计
* 一般假设$\sigma_\eta^2\leq \sigma_L^2$

![image-20200409115243335](图像复原.assets/image-20200409115243335.png)

**自适应中值滤波器**

符号定义：

* $z_{\min}$：$S_{xy}$中灰度级最小值
* $z_{\max}$：$S_{xy}$中灰度级最大值
* $z_{\mathrm{med}}$：$S_{xy}$中灰度级的中值
* $z_{xy}$：坐标$(x,y)$处的灰度值
* $S_{\max}$：$S_{xy}$允许的最大尺寸

自适应中值滤波器算法工作在两个层次，定义为A层和B层

A层：确定中值滤波的输出$z_{med}$是否为一个脉冲噪声

$A_1=z_{med}-z_{min}$

$A_2=z_{med}-z_{max}$

若$A_1>0$且$A_2<0$，转到B层（不是一个脉冲噪声）

否则增大窗口尺寸（若中值为一个噪声，增大窗口尺寸，知道找到非噪声）

如果窗口尺寸$\leq S_{max}$，重复A层

否则输出$z_{med}$

B层：检测中心点$z_{xy}$本身是否是一个脉冲噪声

$B_1=z_{xy}-z_{min}$

$B_2=z_{xy}-z_{max}$

若$B_1>0$且$B_2<0$，输出$z_{xy}$（不是脉冲噪声，直接输出）

否则输出$z_{med}$

<img src="图像复原.assets/image-20200430081905680.png" alt="image-20200430081905680" style="zoom: 50%;" />

**去噪保边的自适应滤波**

<img src="图像复原.assets/image-20200430081944922.png" alt="image-20200430081944922" style="zoom:50%;" />

<img src="图像复原.assets/image-20200430081957838.png" alt="image-20200430081957838" style="zoom:50%;" />

**双边滤波器**

<img src="图像复原.assets/image-20200430082028851.png" alt="image-20200430082028851" style="zoom:50%;" />

双边滤波器：

<img src="图像复原.assets/image-20200430082056297.png" alt="image-20200430082056297" style="zoom:50%;" />

滤波输出：

<img src="图像复原.assets/image-20200430082109895.png" alt="image-20200430082109895" style="zoom:50%;" />

处理效果：

<img src="图像复原.assets/image-20200430082125510.png" alt="image-20200430082125510" style="zoom:50%;" />

<img src="图像复原.assets/image-20200430082206681.png" alt="image-20200430082206681" style="zoom:50%;" />

**图像引导滤波器**

<img src="图像复原.assets/image-20200430082249704.png" alt="image-20200430082249704" style="zoom:50%;" />

<img src="图像复原.assets/image-20200430082404836.png" alt="image-20200430082404836" style="zoom:50%;" />

<img src="图像复原.assets/image-20200430082443532.png" alt="image-20200430082443532" style="zoom:50%;" />

### 频域滤波削减周期噪声

####  带阻滤波器

在频率域噪声分量的一般位置近似已知的应用中消除噪声

**理想带阻滤波器**

<img src="图像复原.assets/image-20200430082730344.png" alt="image-20200430082730344" style="zoom:50%;" />

**N阶巴特沃斯带阻滤波器**

<img src="图像复原.assets/image-20200430082816599.png" alt="image-20200430082816599" style="zoom:50%;" />

**高斯带阻滤波器**

<img src="图像复原.assets/image-20200430082831092.png" alt="image-20200430082831092" style="zoom:50%;" />

<img src="图像复原.assets/image-20200430083129777.png" alt="image-20200430083129777" style="zoom:50%;" />

#### 带通滤波器

带通滤波器执行与带阻滤波器相反的操作

带通滤波器的传递函数$H_{bp}(u,v)$可根据相应的带阻滤波器的传递函数$H_{br}(u,v)$得到：
$$
H_{bp}(u,v)=1-H_{br}(u,v)
$$
可利用带通滤波器提取噪声模式

<img src="图像复原.assets/image-20200430083145999.png" alt="image-20200430083145999" style="zoom:50%;" />

#### 陷波带阻滤波器

<img src="图像复原.assets/image-20200430083241129.png" alt="image-20200430083241129"  />

半径为$D_0$，中心在$(u_0,v_0)$且在$(-u_0,-v_0)$对称

**理想陷波滤波器**

<img src="图像复原.assets/image-20200430083529462.png" alt="image-20200430083529462" style="zoom:50%;" />

**巴特沃斯陷波带阻滤波器**

<img src="图像复原.assets/image-20200430083758648.png" alt="image-20200430083758648" style="zoom:50%;" />

**高斯陷波带阻滤波器**

<img src="图像复原.assets/image-20200430083817185.png" alt="image-20200430083817185" style="zoom:50%;" />

#### 陷波带通滤波器

<img src="图像复原.assets/image-20200430083928079.png" alt="image-20200430083928079" style="zoom:67%;" />

<img src="图像复原.assets/image-20200430083955097.png" alt="image-20200430083955097" style="zoom:50%;" />

#### 最佳陷波滤波器

1.  从被干扰图像中分离出周期性干扰噪声的主要成分
	* 观察频谱图，选定干扰频点，交互式创建陷波带通滤波器
	* 利用陷波带通滤波器，提取出各个噪声成分

2.  从被干扰图像中按权重减去各个干扰频谱的成分。

**第一步：**

在每个尖峰处设置一陷波带通滤波器$H(u,v)$

干扰噪声模式的傅里叶变换为：$N(u,v)=H(u,v)G(u,v)$

选中一个滤波器后，空间域相应的噪声模式可由下式获得：
$$
\eta(x,y)=\mathcal{J}^{-1}\{H(u,v)G(u,v)\}
$$
由于$G(u,v)=F(u,v)+N(u,v)$

若$\eta(x,y)$完全已知，则可从$g(x,y)$减去模式得到$f(x,y)$

但是，$N(u,v)$是通过交互式过程估计$H(u,v)$得到的，滤波过程只会得到真实$f(x,y)$的估计
$$
\hat{f}(x,y)=g(x,y)-w(x,y)\eta(x,y)
$$
选取$w(x,y)$使估计值$\hat f(x,y)$在每一个点$(x,y)$的指定领域上方差最小

考虑点$(x,y)$和尺寸为$(2a+1)\times (2b+1)$的领域

在坐标$(x,y)$处，$\hat f(x,y)$的局部方差可根据以下方法估计：
$$
\sigma^2(x,y)=\frac{1}{(2a+1)(2b+1)}\sum\limits_{s=-a}^a\sum\limits_{s=-b}^b[\hat f(x+s,y+t)-\overline{\hat f}(x,y)]
$$
求$\sigma^2(x,y)$的极小值点，解：
$$
\frac{\partial \sigma^2(x,y)}{\partial w(x,y)}=0
$$
计算$\hat f(x,y)$时，先计算$w(x,y)$，若假定$w(x,y)$在某一领域内为常量，则在每一个非重叠领域的一点计算$w(x,y)$的值，然后处理该领域内包含的所有图像点

$w(x,y)$的解为：
$$
w(x,y)=\frac{\overline{g(x,y)\eta(x,y)}-\overline{g}(x,y)\overline{\eta}(x,y)}{\overline{\eta^2}(x,y)-\overline{\eta}^2(x,y)}
$$
<img src="图像复原.assets/image-20200430091248747.png" alt="image-20200430091248747" style="zoom:50%;" />

## LSI系统退化函数的估计

### 线性位置不变系统

$$
H[af_1(x,y)+bf_2(x,y)]=aH[f_1(x,y)]+bH[f_2(x,y)]\\
H[f(x-\alpha,y-\beta)]=g(x-\alpha,y-\beta)
$$

$$
g(x,y)=\int_{-\infty}^{\infty}\int_{-\infty}^{\infty}f(\alpha,\beta)h(x-\alpha,y-\beta)\mathrm{d}\alpha\mathrm{d}\beta+\eta(x,y)
$$

其中，$h(x,\alpha,y,\beta)$为系统$H$的冲激响应（点扩散函数）

#### 线性位置不变系统的退化模型

$$
g(x,y)=h(x,y)*f(x,y)+\eta(x,y)\\
G(u,v)=H(u,v)F(u,v)+N(u,v)
$$

#### 线性位置不变系统退化函数的估计

**观察法**

* 收集图像自身的信息来估计退化函数。
* 从局部推断整体
	* 选择高信噪比区域
	* 观察特定结构的频谱特点
	* 推断退化函数的形状、参数

$$
H_s(u,v)=\frac{G_s(u,v)}{\hat F_s(u,v)}
$$

**试验估计法**

使用成像系统自身或与之相似的系统，通过试验测试得到准确的退化估计

<img src="图像复原.assets/image-20200430092127893.png" alt="image-20200430092127893" style="zoom:50%;" />

由于冲激函数的傅里叶变换为常数$A$，可得：
$$
H(u,v)=\frac{G(u,v)}{A}
$$
<img src="图像复原.assets/image-20200430092214861.png" alt="image-20200430092214861" style="zoom:67%;" />

**数学模型估计法**

通过实验，建立包括成像系统、环境等退化因素的数学、物理模型。

* 一般为经验模型
* 理论推导/需要大量实验的验证，不断修正模型
* 运动模型、大气传输模型、光学系统模型**……** 

举例：

* 大气湍流的物理模型
	$$
	H(u,v)=e^{-k(u^2+v^2)^{5/6}}
	$$
	

	其中$k$为常数，与湍流特性有关

<img src="图像复原.assets/image-20200430092524870.png" alt="image-20200430092524870" style="zoom:50%;" />

* 光学散焦的物理模型
	$$
	H(u,v)=J_1(\pi d\rho)/\pi d\rho\\
	\rho=(u^2+v^2)^{1/2}
	$$
	其中$d$为散焦点扩散函数的直径，$J_1(\cdot)$是第一类贝塞尔函数

	从曝光积分的原理上，推导光学系统成像过程受到物体运动的干扰
	$$
	H(u,v)=\frac{T}{\pi(ua+vb)}\sin[\pi(ua+vb)]e^{-j\pi(ua+vb)}
	$$
	<img src="图像复原.assets/image-20200430092845399.png" alt="image-20200430092845399" style="zoom:50%;" />

## LSI系统图像复原

### 逆滤波

