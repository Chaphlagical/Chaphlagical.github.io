---
title: 小波变换
tags: 数字图像处理
article_header:
  type: cover
  image:
    src: /assets/images/DIP.jpg
---

<!--more-->

## 一、小波介绍

### (一) 小波简介

#### 1、小波

* 在有限时间范围内变化且其平均值为零的数学函数
	* 具有有限的持续时间和突变的频率和振幅
	* 在有限的时间范围内，它的平均值等于零

<img src="/assets/images/小波变换.assets/image-20200423095242947.png" alt="image-20200423095242947" style="zoom:50%;" />

#### 2、部分小波

![image-20200423095304241](/assets/images/小波变换.assets/image-20200423095304241.png)

#### 3、小波变换 vs 傅里叶变换

<img src="/assets/images/小波变换.assets/image-20200423095422522.png" alt="image-20200423095422522" style="zoom:50%;" />

<img src="/assets/images/小波变换.assets/image-20200423095435203.png" alt="image-20200423095435203" style="zoom:50%;" />

**傅里叶变换：**
$$
F(\omega)=\int^\infty_{-\infty}f(t)*e^{i\omega t}dt
$$
傅里叶变换只有一个变量$\omega$， 对应频率上的变化，傅里叶变换变换可以得到时域信号的频域谱

**小波变换**
$$
WT(\alpha,\tau)=\frac{1}{\sqrt{a}}\int^\infty_{-\infty}f(t)*\psi(\frac{t-\tau}{a})dt
$$
小波变换有两个变量，尺度$a$和平移$τ$，分别控制小波的伸缩和平移。 尺度对应频率上的变化，平移对应时间上的变化。小波变换不仅可以得到频域谱，而且可以得到时域谱

#### 4、小波分析

变换目的是获得时间和频率域之间的相互关系

* **小波变换**

	* 对一个函数在空间和时间上进行局部化的一种数学变换
		* 通过平移母小波(mother wavelet)获得信号的时间信息通过缩放母小波的宽度(或称尺度)获得信号的频率特性
		* 对母小波的平移和缩放操作是为计算小波的系数，这些系数代表局部信号和小波之间的相互关系
	* 对比傅立叶变换
		* 提供了频率域的信息，但丢失了时间域的局部化信息

* **小波分析中常用的三个基本概念**

	* 连续小波变换
	* 离散小波变换
	* 小波重构

* **连续小波变换(CWT)**

  * 傅里叶分析
  	* 用一系列不同频率的正弦波表示一个信号
  	* 一系列不同频率的正弦波是傅立叶变换的基函数
  * 小波分析
  	* 用母小波通过移位和缩放后得到的一系列小波表示一个信号
  	* 一系列小波可用作表示一些函数的基函数
  * 凡能用傅立叶分析的函数都可用小波分析
  	
  	* 小波变换可理解为用经过缩放和平移的一系列函数代替傅立叶变换用的正弦波
  * 用不规则的小波分析变化激烈的信号比用平滑的正弦波更有效，或者说对信号的基本特性描述得更好

  * 变换过程：

  	1. 小波$\psi(t)$和原始信号$f(t)$的开始部分进行比较

  	2. 计算系数$*C$——*该部分信号与小波的近似程度；*C*值越高表示信号与小波相似程度越高

  	3. 小波右移$k$得到的小波函数为$ψ (t-k) $，然后重复步骤1和2，……直到信号结束
  	4. 扩展小波，如扩展一倍，得到的小波函数为$ψ (t/2)$
  	5. 重复步骤1~4 

  	<img src="/assets/images/小波变换.assets/image-20200423101503732.png" alt="image-20200423101503732" style="zoom:50%;" />

  * 连续小波用下式表示：
  	$$
  	C(scale,position)=\int_{-\infty}^\infty f(t)\psi(scale,position,t)dt
  	$$

  	* 该式含义：小波变换是信号$f(t)$与被缩放和平移的小波函数$Ψ$之积在信号存在的整个期间里求和
  	* CWT变换的结果是许多小波系数$C$，这些系数是缩放因子(scale)和位置(position)的函数

* **离散小波变换(DWT)**

	* 用小波的基函数表示一个函数的方法

		* 小波的基函数序列或称子小波(baby wavelets)函数是由单个小波或称为母小波函数通过缩放和平移得到的
		* 缩放因子和平移参数都选择$2j $ ($j >0$的整数)的倍数，这种变换称为双尺度小波变换(dyadic wavelet transform)

	* DWT得到的小波系数、缩放因子和时间关系

		* Cabor开发的短时傅里叶变换STFT
		* Morlet小波变换

		<img src="/assets/images/小波变换.assets/image-20200423103730707.png" alt="image-20200423103730707" style="zoom:50%;" />

	* 执行DWT的有效方法

		* 用Mallat在1988年开发的滤波器，称为Mallat算法
		* DWT的概念见下图。S表示原始的输入信号；通过两个互补的滤波器产生A和D两个信号

		<img src="/assets/images/小波变换.assets/image-20200423103941568.png" alt="image-20200423103941568" style="zoom:50%;" />

		* A表示信号的近似值(approximations)**，**大的缩放因子产生的系数，表示信号的低频分量
		* D表示信号的细节值(detail)，小的缩放因子产生的系数，表示信号的高频分量

* **小波分解树与小波包分解树**

	* 由低通滤波器和高通滤波器组成的树
		* 原始信号通过一对滤波器进行的分解叫做一级分解。信号的分解过程可以迭代，即可进行多级分解.
	* 小波分解树(wavelet decomposition tree)
		* 用下述方法分解形成的树：对信号的高频分量不再继续分解，而对低频分量连续进行分解，得到许多分辨率较低的低频分量.
	* 小波包分解树(wavelet packet decomposition tree) 
		* 用下述方法分解形成的树：不仅对信号的低频分量连续进行分解，而且对高频分量也进行连续分解，这样不仅可得到许多分辨率较低的低频分量，而且也可得到许多分辨率较低的高频分量

	<img src="/assets/images/小波变换.assets/image-20200423110742035.png" alt="image-20200423110742035" style="zoom:50%;" />
	$$
	S=A_1+AAD_3+DAD_3+DD_2
	$$
	<img src="/assets/images/小波变换.assets/image-20200423110754480.png" alt="image-20200423110754480" style="zoom:50%;" />

	* 在使用滤波器对真实的数字信号进行变换时，得到的数据将是原始数据的两倍

		* 例如，如果原始信号的数据样本为1000个，通过滤波之后每一个通道的数据均为1000个，总共为2000个。于是,根据尼奎斯特(Nyquist)采样定理就提出了采用降采样(downsampling)的方法，即在每个通道中每两个样本数据中取一个，得到的离散小波变换的系数(coefficient)分别用cD和cA表示

			<img src="/assets/images/小波变换.assets/image-20200423112813814.png" alt="image-20200423112813814" style="zoom:50%;" />

* 小波重构

	* 重构概念

		* 把分解的系数还原成原始信号的过程叫做小波重构(wavelet reconstruction)或合成(synthesis)，数学上叫做逆离散小波变换(inverse discrete wavelet transform，IDWT)

	* 两个过程

		* 在使用滤波器做小波变换时包含滤波和降采样(downsampling)两个过程，在小波重构时也包含升采样(upsampling)和滤波两个过程
		* 升采样是在两个样本数据之间插入“0”，目的是把信号的分量加长

		<img src="/assets/images/小波变换.assets/image-20200423113818155.png" alt="image-20200423113818155" style="zoom:50%;" />

* 重构滤波器

	* 滤波器关系到能否重构出满意的原始信号。在信号的分解期间，降采样会引进畸变，这种畸变叫做混叠(aliasing)。这就需要在分解和重构阶段精心选择关系紧密但不一定一致的滤波器才有可能取消这种混叠

	<img src="/assets/images/小波变换.assets/image-20200423113858268.png" alt="image-20200423113858268" style="zoom:50%;" />

* 低通分解滤波器(L)和高通分解滤波器(H)以及重构滤波器(L‘和H’)构成一个系统，这个系统叫做正交镜像滤波器(quadrature mirror filters，QMF)系统，如下图所示

	 <img src="/assets/images/小波变换.assets/image-20200423113925606.png" alt="image-20200423113925606" style="zoom:50%;" />

## 二、哈尔函数

### (一) 哈尔基函数

* 基函数是一组线性无关的函数，可以用来构造任意给定的信号，如用基函数的加权和表示

* 哈尔基函数

	* 定义在半开区间$[0,1)$上的一组分段常值函数集
	* 生成矢量空间$V^0$的常值函数

	$$
	V^0: \phi_0^0(x)=\begin{cases}1&0\leq x<1\\0&其他  \end{cases}
	$$

	* 波形：

		<img src="/assets/images/小波变换.assets/image-20200423114252793.png" alt="image-20200423114252793" style="zoom:50%;" />

	* 生成矢量空间$V^1$的常值函数
		$$
		V^1:\begin{matrix}\phi_0^1(x)=\begin{cases}1&0\leq x<0.5\\0&其他\end{cases}\\
		\phi_1^1(x)=\begin{cases}1&0.5\leq x<1\\0&其他\end{cases}
		\end{matrix}
		$$
		<img src="/assets/images/小波变换.assets/image-20200423114514360.png" alt="image-20200423114514360" style="zoom:50%;" />

	* 生成矢量空间$V^2$的常值函数
		$$
		\begin{matrix}
		\phi_0^2(x)=\begin{cases}1&0\leq x<1/4\\0&其他\end{cases}&
		\phi_1^2(x)=\begin{cases}1&1/4\leq x<1/2\\0&其他\end{cases}\\
		\phi_2^2(x)=\begin{cases}1&1/2\leq x<3/4\\0&其他\end{cases}&
		\phi_3^2(x)=\begin{cases}1&3/4\leq x<1\\0&其他\end{cases}
		\end{matrix}
		$$
		![image-20200423114719189](/assets/images/小波变换.assets/image-20200423114719189.png)

		可按照以上方法继续定义哈尔基函数和由它生成的矢量空间$V^i$

	* 为了表示矢量空间中的矢量，每一个矢量空间都需要定义一个基(basis)，哈尔基定义为
		$$
		\phi(x)=\begin{cases}1&0\leq x<1\\0&其他\end{cases}
		$$
		为生成矢量空间而定义的基函数也叫做尺度函数(scaling function)。哈尔基尺度函数定义为
		$$
		\phi_i^j(x)=\phi(2^jx-i),i=0,1,\cdots,(2^j-1)
		$$
		其中，$j$为尺度因子，使函数图形缩小或放大，$i$为平移参数，使函数沿$x$轴方向平移

### (二) 哈尔小波（函数）

* 最古老和最简单的小波，定义为：
	$$
	\psi(x)=\begin{cases}1&0\leq x<1/2\\-1&1/2\leq x<1\\0&其他\end{cases}
	$$
	生成矢量空间$W^0$的哈尔小波
	$$
	\psi_0^0(x)=\begin{cases}
	1&0\leq x<1/2\\
	-1&1/2\leq x<1\\
	0&其他
	\end{cases}
	$$
	<img src="/assets/images/小波变换.assets/image-20200425095036364.png" alt="image-20200425095036364" style="zoom:50%;" />

	生成矢量空间$W^1$的哈尔小波
	$$
	\begin{matrix}
	\psi_0^1(x)=\begin{cases}
	1&0\leq x<1/4\\
	-1&1/4\leq x<1/2\\
	0&其他
	\end{cases}
	&
	\psi_1^1(x)=\begin{cases}
	1&1/2\leq x<3/4\\
	-1&3/4\leq x<1/2\\
	0&其他
	\end{cases}
	\end{matrix}
	$$
	<img src="/assets/images/小波变换.assets/image-20200430095125972.png" alt="image-20200430095125972" style="zoom:50%;" />
	
	生成矢量空间$W^2$的哈尔小波
	$$
	\begin{matrix}
	\psi_0^2(x)=\begin{cases}
	1&0\leq x<1/8\\
	-1&1/8\leq x<2/8\\
	0&其他
	\end{cases}
	&
	\psi_1^2(x)=\begin{cases}
	1&2/8\leq x<3/8\\
	-1&3/8\leq x<4/8\\
	0&其他
	\end{cases}
	\\
	\psi_2^2(x)=\begin{cases}
	1&4/8\leq x<5/8\\
	-1&5/8\leq x<6/8\\
	0&其他
	\end{cases}
	&
	\psi_3^2(x)=\begin{cases}
	1&6/8\leq x<7/8\\
	-1&7/8\leq x<1\\
	0&其他
	\end{cases}
	
	\end{matrix}
	$$
	<img src="/assets/images/小波变换.assets/image-20200430095419412.png" alt="image-20200430095419412" style="zoom:50%;" />

## 三、哈尔小波变换

### (一) 求有限信号的均值和差值（一维小波变换）

* 假设有一幅分辨率只有4个像素$P_0$、$P_1$、$P_2$、$P_3$的一维图像，对应的像素值分别为
	$$
	\begin{bmatrix}9&7&3&5\end{bmatrix}
	$$
	计算该图像的哈尔小波变换系数

	* **步骤1**：求均值(averaging)。计算相邻像素对的平均值，得到一幅分辨率比较低的新图像，它的像素数目变成了2个，即新的图像的分辨率是原来的1/2，相应的像素值为
		$$
		\begin{bmatrix}8&4\end{bmatrix}
		$$

	* **步骤2**：求差值(differencing)。为能从2个像素组成的图像重构由4个像素组成的原始图像，就需要存储一些图像的细节系数(detail coefficient)

		* 方法是把像素对的第一个像素值减去这个像素对的平均值，或者使用这个像素对的差值除以2

		原始图像用两个均值和两个细节系数表示为
		$$
		\begin{bmatrix}8&4&1&-1\end{bmatrix}
		$$

	* **步骤3**：重复步骤1和2，把由第一步分解得到的图像进一步分解成分辨率更低的图像和细节系数。其结果，整幅图像表示为
		$$
		\begin{bmatrix}6&2&1&-1\end{bmatrix}
		$$

	哈尔变换的过程：

	| 分辨率 | 平均值      | 细节系数 |
	| ------ | ----------- | -------- |
	| 4      | [9 7   3 5] |          |
	| 2      | [8 4]       | [1 -1]   |
	| 1      | [6]         | [2]      |

* 把由4个像素组成的一幅图像用一个平均像素值和三个细节系数表示，这个过程称为哈尔小波变换(Haar wavelet transform)，也称哈尔小波分解(Haar wavelet decomposition)。这个概念可以推广到使用其他小波基的变换

* **特点**：(1) 变换过程中没有丢失信息，因为能够从所记录的数据中重构出原始图像。(2) 对这个给定的变换，可从所记录的数据中重构出各种分辨率的图像。(3) 通过变换之后产生的细节系数的幅度值比较小，为图像压缩提供了一种途径，如去掉微不足道的系数

### (二) 哈尔小波变换

* $I(x)$图像用$V^2$中的哈尔基表示
	$$
	I(x)=9\phi_0^2(x)+7\phi_1^2(x)+3\phi_2^2(x)+5\phi_3^2(x)
	$$
	<img src="/assets/images/小波变换.assets/image-20200430100807554.png" alt="image-20200430100807554" style="zoom:50%;" />

* $I(x)$图像用$V^1$和$W^1$中的函数表示

	生成$V^1$矢量空间的基函数为$\phi_0^1(x)$和$\phi_1^1(x)$，生成矢量空间$W^1$的小波函数为$\psi_1^1(x)$和$\psi_0^1(x)$，$I(x)$可表示为
	$$
	I(x)=c_0^1\phi_0^1(x)+c_1^1\phi_1^1(x)+d_0^1\psi_0^1(x)+d_1^1\psi_1^1(x)
	$$
	<img src="/assets/images/小波变换.assets/image-20200430101100433.png" alt="image-20200430101100433" style="zoom:50%;" />

* $I(x)$图像用$V^0$、$W^0$和$W^1$中的函数表示

	生成矢量空间$V^0$的基函数为$\phi_0^0(x)$，生成矢量空间$W^0$的小波函数为$\psi_0^0(x)$，生成矢量空间$W^1$的小波函数为$\psi_0^1(x)$和$\psi_1^1(x)$，$ I(x)$可表示为
	$$
	I(x)=c_0^0\phi_0^0(x)+d_0^0\psi_0^0(x)+d_0^1\psi_0^1(x)+d_1^1\psi_1^1(x)
	$$
	<img src="/assets/images/小波变换.assets/image-20200430101511121.png" alt="image-20200430101511121" style="zoom:50%;" />

## 四、二维哈尔小波变换

### (一) 标准分解

* 首先使用一维小波对图像每一行的像素值进行变换，产生每一行像素的平均值和细节系数，然后使用一维小波对这个经过行变换的图像的列进行变换，产生这个图像的平均值和细节系数

* 分解的过程如下：

	<img src="/assets/images/小波变换.assets/image-20200430101802182.png" alt="image-20200430101802182" style="zoom:50%;" />

<img src="/assets/images/小波变换.assets/image-20200430101816459.png" alt="image-20200430101816459" style="zoom:50%;" />

### (二) 非标准分解

* 用一维小波交替地对每一行和每一列像素值进行变换。
	* 对每一行计算像素对的均值和差值，然后对每一列计算像素对的均值和差值
	* 对包含均值的1/4像素计算行和列的均值和差值，依此类推
* 过程如下：

<img src="/assets/images/小波变换.assets/image-20200430101916310.png" alt="image-20200430101916310" style="zoom:50%;" />

<img src="/assets/images/小波变换.assets/image-20200430101930101.png" alt="image-20200430101930101" style="zoom:50%;" />

<img src="/assets/images/小波变换.assets/image-20200430101950754.png" alt="image-20200430101950754" style="zoom:50%;" />

<img src="/assets/images/小波变换.assets/image-20200430102034916.png" alt="image-20200430102034916" style="zoom:50%;" />

## 五、图像多分辨率表示

图像金字塔就是一系列以金字塔形状排列的分辨率逐步降低的图像的集合

<img src="/assets/images/小波变换.assets/image-20200430102056362.png" alt="image-20200430102056362" style="zoom: 50%;" />

金字塔的底部是待处理的图像的高分辨率表示，顶部是低分辨率的近似。设图像大小为$N \times N=2^J x\times 2^J $，则金字塔一共具有$J$级。则中间第$j$级的大小为$2^j \times 2^j$, 其中$0\leq j<\leq J$. 通常我们只使用其中的$P$级来构建原始图像的金字塔。

### (一) 金字塔的构建

1. 计算输入图像的低一级的分辨率近似值。这可以通过对输入图像进行滤波操作，并进行2倍的下采样。可以采用多种滤波器，如邻域平均（可生成平均值金字塔），高斯低通滤波器（可生成高斯金字塔）。输出就为$j-1$层的的低分辨率近似值。
2. 对上一步的输出进行2倍内插（上采样），并进行滤波处理，作为$j$级图像的预测值。
3. 计算步骤2的预测值和步骤1的输入之间的差异，作为$j$级预测残差图像，可用于后续原始图像的重建。

<img src="/assets/images/小波变换.assets/image-20200430102305988.png" alt="image-20200430102305988" style="zoom:50%;" />

### (二) 子带编码

* 在子带编码中，一幅图像被分解成为一系列限带分量的集合，称为子带，它们可以重组在一起无失真地重建原始图像

<img src="/assets/images/小波变换.assets/image-20200430102400470.png" alt="image-20200430102400470" style="zoom:50%;" />

* 系统的输入是一个一维的带限时间离散信号$x(n),n=0,1,2,\cdots$输出序列$\hat x(n)$是通过学习分析滤波器$h_0(n)$和$h_1(n)$将$x(n)$分解成$y_0(n)$和$y_1(n)$，然后再通过综合滤波器$g_0(n)$和$g_1(n)$综合得到的。

* •一维滤波器也可以推广到二维可分离滤波器，可分离滤波器首先应用于某一维(如垂直向)，再应用于另一维(如水平向)，滤波后的输出结果包括$a(m,n)$，$d^V(m,n)$，$d^H(m,n)$，$d^D(m,n)$分别称为近似值、垂直细节、水平细节和对角线细节

	<img src="/assets/images/小波变换.assets/image-20200430105040713.png" alt="image-20200430105040713" style="zoom:50%;" />

## 六、小波变换的多频率分析特性

$L^2(R)$是一个是一个无限维向量空间，称为平方可积空间，将$L^2(R)$用它的子空间$\{V_j\}_{j\in Z}$，$\{W_j\}_{j\in Z}$表示，其中$\{V_j\}_{j\in Z}$称为尺度空间，$\{W_j\}_{j\in Z}$称为小波空间。 

 尺度空间的递归嵌套关系：$\{0\}\cdots\subset V_{-1}\subset V_0\subset V_1\subset\cdots L^2(R)$

 小波空间$W_j$是$V_j$和$V_{j+1}$之间的差，即$V_j\oplus W_j=V_{j+1}$，它捕捉由$V_j$逼近$V_{j+1}$时丢失的信息。推出：
$$
V_0\oplus W_0\oplus W_1\oplus\cdots\oplus W_j=V_{j+1}
$$
<img src="/assets/images/小波变换.assets/image-20200430110025116.png" alt="image-20200430110025116" style="zoom: 50%;" />

## (一) 双尺度函数

若$\phi$是尺度函数，它生成$L^2(R)$的多分辨分析$\{V_j\}_{j\in Z}$，则必然存在系数序列$(h_k)_{k\in Z}$，使得以下尺度关系成立:
$$
\phi(t)=\sqrt{2}\sum\limits_k h_k\phi(2t-k)\sum\limits_k h_0(k)=\sqrt{2}
$$
这就是双尺度方程，必须满足下列条件：
$$
\begin{matrix}
\sum\limits_k h_0(k)=\sqrt{2}&\sum\limits_k h_0(k)h_0(k+2l)=\delta(l)
\end{matrix}
$$
定义函数$\phi(t)\in L^2(R)$为尺度函数，若其经过整数平移$k$和尺度$j$上的伸缩，得到一个尺度和位移均可变化的函数集合：
$$
\phi_{j,k}(t)=2^{-\frac{j}{2}}\phi(2^{-j}t-k)
$$
若$\psi(t)$为小波变换，则$\phi(t)$和$\psi(t)$构成双尺度函数，其基本性质是：
$$
\begin{matrix}
\phi(2^{-j}t)=\sqrt{2}\sum\limits_{k}h_k\phi(2^{-j+1}t-k)&\sum\limits_n h_k=\sqrt{2}\\

\psi(2^{-j}t)=\sqrt{2}\sum\limits_k g_k\phi(2^{-j+1}t-k)&\sum\limits_n g_k=0
\end{matrix}
$$
双尺度方程的频域表示为
$$
\sqrt{2}\phi(2\omega)=H(\omega)\phi(\omega)\\
\sqrt{2}\psi(2\omega)=G(\omega)\phi(\omega)
$$

### (二) 离散小波变换

如果设定$a=2^{-j}$，$b=k2^{-j}$，$j,k\in Z$，则
$$
\psi_{2^{-j},k2^{-j}}(t)=2^{j/2}\psi(2^jt-k),j,k\in Z
$$
对于任意函数$f(t)\in L^2(-\infty,+\infty)$，定义相应的离散小波变换为：
$$
WT_f(j,k)=\int_{-\infty}^{+\infty}f(t)\overline{\psi_{j,k}(t)}dt\ \ \ j,k\in Z
$$
如果这时$\psi_{j,k}$构成空间$L^2(-\infty,+\infty)$的一组规范正交基，对于任一的函数$f(t)\in L^2(-\infty,+\infty)$的反演式为展开式：
$$
f(t)=\sum\limits_{j,k\in Z}WT_f(j,k)\psi_{j,k}
$$

### (三) 二进小波及二进小波变换

在连续小波变换中，令参数$a=2^j,j\in Z$而参数$b$仍取连续值，则有二进小波：
$$
\psi_{2^j,b}(t)=2^{-j/2}\psi[2^{-j}(t-b)]
$$
这时，$f(t)\in L^2(R)$的二进小波变换定义为：
$$
WT_f(2^j,b)=2^{-j/2}\int^{+\infty}_{-\infty}f(t)\psi^*[2^{-j}(t-b)]\mathrm d t
$$

### (四) Mallet算法与塔式分解

系数分解的快速方法：
$$
C_{j,k}=\sum\limits_{m}h(m-2k)C_{j-1,m}\\
d_{j,k}=\sum\limits_mg(m-2k)d_{j-1,m}
$$
<img src="/assets/images/小波变换.assets/image-20200504234125672.png" alt="image-20200504234125672" style="zoom:67%;" />

系数重构的快速方法：
$$
C_{j-1,k}=\sum\limits_m C_{j,m}h(m-2k)+\sum\limits_md_{j-1,m}g(m-2k)
$$
<img src="/assets/images/小波变换.assets/image-20200504234254599.png" alt="image-20200504234254599" style="zoom: 67%;" />

### (五) 二维图像的小波变换实现

假定二维尺度函数可分离，则有：
$$
\varphi(x,y)=\varphi(x)\varphi(y)
$$
其中$\varphi(x)$、$\varphi(y)$是两个一维尺度函数。若$\psi(x)$是相应的小波，那么下列三个二维基本小波：
$$
\psi_{(x,y)}^1=\varphi(x)\psi(y)\\
\psi_{(x,y)}^2=\psi(x)\varphi(y)\\
\psi^3_{(x,y)}=\psi(x)\psi(y)
$$
与$\varphi(x,y)$一起建立了二维小波变换的基础

#### 1、正变换

图像小波分解的正变换可以依据二维小波变换按如下方式扩展，在变换的每一层次，图像都被分解为4个四分之一大小的图像

<img src="/assets/images/小波变换.assets/image-20200504235136707.png" alt="image-20200504235136707" style="zoom:67%;" />

在每一层，四个图像中的每一个都是由原图像与一个小波基图像的内积后再经过在x和y方向都进行二倍的间隔抽样而生成。对于第一个层次($j=1$)可写成：
$$
A_2^0(m,n)=< A_1^0(x,y),\varphi(x-2m,y-2n)>\\
D_2^1(m,n)=<A_1^0(x,y),\psi^1(x-2m,y-2n)>\\
D_2^2(m,n)=<A_1^0(x,y),\psi^2(x-2m,y-2n)>\\
D_2^3(m,n)=<A_1^0(x,y),\psi^3(x-2m,y-2n)>
$$
将上式内积改写成卷积形式，则得到离散小波变换的Mallat算法的通用公式：
$$
A^0_{j+1}(m,n)=\sum\limits_{x,y}A^0_{2^j}(x,y)h(x-2m)h(y-2n)\\
D^1_{j+1}(m,n)=\sum\limits_{x,y}A^0_{2^j}(x,y)h(x-2m)g(y-2n)\\
D^2_{j+1}(m,n)=\sum\limits_{x,y}A^0_{2^j}(x,y)g(x-2m)h(y-2n)\\
D^3_{j+1}(m,n)=\sum\limits_{x,y}A^0_{2^j}(x,y)g(x-2m)g(y-2n)\\
$$

#### 2、逆变换

在每一层(如最后一层)都通过在每一列的左边插入一列零来增频采样前一层的4个阵列(即4个分解图像)；

接着用重构低通滤波器$h$和重构高通滤波器$g$来卷积各行，再成对地把这几个的阵列加起来；

然后通过在每行上面再插入一列零来将刚才所得两个阵列(图像)的大小增频采样为$N×N$**；**

再用$h$和$g$与这两个阵列的每列进行卷积。这两个阵列的和就是这一层次重建的结果

#### 3、Mallet二维多分辨率分解与重构

<img src="/assets/images/小波变换.assets/image-20200505000620194.png" alt="image-20200505000620194" style="zoom:67%;" />

<img src="/assets/images/小波变换.assets/image-20200505000704523.png" alt="image-20200505000704523" style="zoom:67%;" />

#### 4、多孔算法

<img src="/assets/images/小波变换.assets/image-20200505000730843.png" alt="image-20200505000730843" style="zoom:67%;" />

<img src="/assets/images/小波变换.assets/image-20200505000747521.png" alt="image-20200505000747521" style="zoom:67%;" />

## 七、小波变换在图像边缘检测中的应用

边缘像素实质上是局部图像范围内灰度的急剧变化点(奇异点)，图像边缘就是二维图像中奇异点的集合。边缘点在频域表现为高频信号，而图像噪声也多为高频信号，这使得两者难以区分。边缘检测的目的就是既要将高频信号从图像中分离出来，又要区分边缘与噪声，准确地标定边缘的位置。

### (一) 小波多尺度局部模极大值边缘检测的原理

假设$\theta(x,y)$是二维平滑函数，且满足$\iint \theta(x,y)\mathrm dx\mathrm d y\neq 0$可把它沿$x$，$y$两个方向上的导数作为基本小波：
$$
\begin{matrix}
\Psi^{(1)}(x,y)=\frac{\partial \theta(x,y)}{\partial x}&
\Psi^{(2)}(x,y)=\frac{\partial \theta(x,y)}{\partial y}\\
\Psi_a^{(1)}(x,y)=\frac{1}{a^2}\Psi^{(1)}(\frac{x}{a},\frac{y}{a})&
\Psi_a^{(2)}(x,y)=\frac{1}{a^2}\Psi^{(2)}(\frac{x}{a},\frac{y}{a})
\end{matrix}
$$
对于一幅图像$f(x,y)$，其小波变换为：
$$
\begin{bmatrix}
W_T^{(1)}f(2^j,x,y)\\W_T^{(2)}f(2^j,x,y)
\end{bmatrix}
=
2^j
\begin{bmatrix}
\frac{\partial}{\partial x}[f(x,y)*\theta_a(x,y)]\\
\frac{\partial}{\partial y}[f(x,y)*\theta_a(x,y)]\\
\end{bmatrix}=
2^j grad[f(x,y)*\theta_a(x,y)]
$$
整个图像的二进小波变换即矢量：
$$
\begin{bmatrix}
W_T^{(1)}f(2^j,x,y)\\W_T^{(2)}f(2^j,x,y)
\end{bmatrix}=W_Tf(2^j,x,y)
$$
模值：
$$
\sqrt{\Big|W_T^{(1)}f(2^j,x,y) \Big|^2+\Big|W_T^{(2)}f(2^j,x,y) \Big|^2}
$$
相角：
$$
Af_{2^j}(x,y)=\tan^{-1}\frac{\Big|W_T^{(2)}f(2^j,x,y) \Big|}{\Big|W_T^{(1)}f(2^j,x,y) \Big|}
$$

### (二) 小波多分辨率边缘检测的具体实现

**搜寻模极大值：**

<img src="/assets/images/小波变换.assets/image-20200505084223481.png" alt="image-20200505084223481" style="zoom:67%;" />

**边缘点的链接：**

边缘追踪算法的四个约束条件：

1. “方向不变性”原则
2. 角度平滑条件
3. 幅值最邻近条件
4. “互认”原则

<img src="/assets/images/小波变换.assets/image-20200505084510925.png" alt="image-20200505084510925" style="zoom:67%;" />

**小波变换模极大值的多尺度综合方法**

1. 求出各尺度的模图像簇$Mf(x,y)$和相角图像簇$Af(x,y)$

2. 对各尺度的边缘图像进行阈值处理

3. 将相角$Af_{2^j}(x,y)$按8方向量化，求出$Mf_{2^j}(x,y)$在不同方向的局部模极大值点

4. 由粗到细的边缘链接：对经过阈值处理的最粗分辨率级上的模极大值开始，链接模极大值图像中模值相近，相角相似的非零像素点，删除长度小于链长阈值的边缘链，得到大尺度下单像素宽的图像边缘$E_{2^j}(x,y)$
5. 针对尺度$j$的每一个边缘像素，搜索$j-1$尺度下以这点为中心的$3X3$邻域，将该邻域内出现的所有可能边缘点均标记为候选边缘点，得到$j-1$尺度下的候选边缘点图像$H^{j-1}(x,y)$非候选边缘点标记为零；
6. 将$j-1$尺度下的候选边缘点图像$H^{j-1}(x,y)$中模值相近，相角相似的非零像素点链接，删除长度小于阈值的边缘链，得到$j-1$尺度下单像素宽的图像边缘$E_{2^{j-1}}(x,y)$
7. 重复步骤5，6，直到$j-1$为止，边缘图像即为综合后形成的边缘图像，也就是我们最终所要得到的边缘图像

### (三) 小波函数的选取

在实际边缘检测中，小波函数的选取直接关系到边缘检测的结果，小波变换相当于对图像进行带通滤波，在一定程度上减少了噪声对图像的影响，但同时也去掉了一些模糊边缘。这就要求寻找一种具有好的去噪特性同时又能精确地提取边缘的小波函数，而且这种小波在满足Canny准则的同时应具有限紧支撑特性。在关于边缘提取的文献中，主要采用的是正交小波，双正交小波和B样条小波作为边缘提取的小波函数。通常选取高斯函数作为平滑函数。三次B样条函数已很接近高斯函数，能满足大多数的应用，而它的紧支性优于高斯函数。在有噪声环境下进行边缘检测时，需要平衡噪声抑制能力与边缘定位精度，此时三次B样条函数是最优的

### (四) 自适应阈值选取

选择一个窗口在小波系数上滑动，窗口大小可以取$32×32$或$16×16$，将尺度下小于阈值 的梯度值置为0，自适应阈值为：
$$
T_n=T_0+\frac{\alpha_0}{N}\sum\limits_{i,j}Mf_{i,j}
$$
其中，$T_0$为阈值初值，$\alpha_0$为比例系数，$N$为采样点数。根据$T_0$和$\alpha_0$的大小来决定窗口内均值对阈值的作用

## 八、小波变换在图像去噪与增强中的应用

### (一) 高频系数置零去噪

1. 对噪声图像进行二维离散小波分解，分解层数一般取2或3层，分解过程如下图。
2. 对每一层的高频系数LH，HL，HH，置零。

3. 对小波系数进行重构

<img src="/assets/images/小波变换.assets/image-20200505085257312.png" alt="image-20200505085257312" style="zoom:67%;" />

### (二) 基于小波硬阈值的去噪方法

1. 首先将图像信号求小波变换

2. 除了最粗尺度信号外，将各细节信号作阈值处理，当某位置小波变换值大于阈值时，保留原值，否则置零。即

$$
W^iy_{j,(k,l)}=
\begin{cases}
W^iy_{j,(k,l)}&\Big|W^iy_{j,(k,l)}\Big|\geq \lambda\\
0&\Big|W^iy_{j,(k,l)}\Big|\leq \lambda
\end{cases}
$$

3. 利用小波变换重构，求出信号的滤波值

<img src="/assets/images/小波变换.assets/image-20200505085848420.png" alt="image-20200505085848420" style="zoom:67%;" />

### (三) 基于小波软阈值的去噪方法

1. 首先对图像信号进行小波变换，得出带有噪声的小波系数。

2. 将各细节信号作阈值处理，当某位置小波变换值大于阈值时，作下面运算，下式中$sgn(x)$代表符号函数 
	$$
	W^iy_{j,(k,l)}=\begin{cases}
	sgn(W^iy_{j,(k,l)})*\Big[\Big|W^iy_{j,(k,l)}\Big|-\lambda\Big]&\Big|W^iy_{j,(k,l)}\Big|\geq \lambda\\
	0&\Big|W^iy_{j,(k,l)}\Big|<\lambda
	\end{cases}
	$$
	否则置零

3. 利用小波变换重构，求出信号的滤波值

<img src="/assets/images/小波变换.assets/image-20200505085903411.png" alt="image-20200505085903411" style="zoom:67%;" />

### (四) 非线性软阈值去噪方法

$$
W^iy_{j,(k,l)}=\begin{cases}
W^iy_{j,(k,l)}-\frac{\lambda}{2^j}&W^iy_{j,(k,l)}>\lambda\\
0&W^iy_{j,(k,l)}\leq \lambda\\
W^iy_{j,(k,l)}+\frac{\lambda}{2^j}&W^iy_{j,(k,l)}<-\lambda
\end{cases}
$$

阈值选取：

1. $T=\sigma\sqrt{2\log n}$
2. $T=0$，$3\sigma\sqrt{2\log n}$
3. $T=\sigma\sqrt{\frac{2\log n}{n}}$
4. $T=3\sigma$

其中，噪声方差的估计为$\sigma=MAD/0.6745$， $MAD$为图像中位值，$n$为信号采样点数

**基于小波变换阈值方法去噪的不足**

1. 只适合高斯白噪声的去噪，对椒盐噪声效果不明显。原因在  于阈值法保留的是大于阈值的小波系数，而椒盐噪声在图像上表现为或者是灰度值特别大的白像素，或者特别小的黑像素，椒盐噪声的小波系数都很大，所以不能用阈值分离出来
2. 阈值方法的去噪效果依赖于信噪比的大小，它特别适合信噪比高的图像去噪。
3. 在图像信号不连续点处会有伪吉普斯现象
4. 阈值方法的关键在于阈值的选取，而选择一种普适性很好的阈值选取方法是很困难的，事实上，人们已经证明在均方误差意义上阈值方法能得到原始图像信号的最优估计，然而在实际应用中还是需要根据具体的情况和经验来对一些阈值进行改进。

### (五) 基于多尺度模极大值的小波去噪方法

通过分析图像和噪声在小波域中对应的系数模极大值在不同尺度上的分布情况，来研究图像和噪声的突变点在不同尺度上的传递特性。在从低到高的分解尺度中，图像突变点对应的小波系数极大值具有传递性，而噪声突变点不具有这种传递性。根据这一性质，在确定出各尺度小波系数极大值的基础上，由粗到精的跟踪不同尺度上的小波系数极大值，并依据其不同尺度间的传递性，识别信噪属性，剔除噪声部分对应的小波系数极大值，从而抑制噪声，提高图像质量

**过程：**

1. 小波系数极大值的确定 

2. 图像极大值跟踪

3. 噪声极大值滤除 

### (六) 基于小波系数相关性的去噪方法

信号与噪声的小波变换在各尺度下的不同传播特性表明，信号的小波变换在各尺度间有较强的相关性，而且在边缘处具有很强的相关性；而噪声的小波变换在各尺度间确没有明显的相关性，而且噪声的小波变换主要集中在小尺度各层次中。根据信号与噪声的小波变换在不同尺度间的上述不同特点，可以通过将相邻尺度的小波系数直接相乘来增强信号，抑制噪声。由于噪声主要分布在小尺度上，所以这种现象在小尺度上非常明显

定义$Cor(j,n)=W_{2^j}f(n)\cdot W_{2^{j-1}}f(n)$为尺度$j$上$n$点处的相关系数，为使相关系数与小波系数具有可比性，定义规范化相关系数：
$$
NCor(j,n)=Cor(j,n)\sqrt{PW(j)/PCor(j)}
$$
其中，
$$
PW(j)=\sum\limits_nW_{2^j}f(n)^2\\
PCor(j)=\sum\limits_n Cor(j,n)^2
$$
$PW(j)$和$PCor(j)$分别表示对应于尺度的小波系数与相关系数的能量。显然，在尺度$j$下，小波系数与规范化相关系数具有相同的能量，这为它们之间提供了可比性

**小结：**

* 对小波系数使用阈值的去噪方法速度快，实现简单，所以一直被广泛使用在高斯噪声去除上，其中的硬阈值方法容易产生伪吉普斯效应，软阈值方法克服了这个缺点，图像比较平滑，去噪效果也比硬阈值好，而自适应阈值使用的是局部阈值，比软、硬阈值都好
* 模极大值多尺度链接和小波系数相关去噪两种方法虽然速度都比较慢，但是它们都比阈值方法效果好，对各种噪声效果都比较稳定，特别是对混杂噪声的去除方面。但是在椒盐噪声图像的去噪方面，只有模极大值链接的方法有效果，而且比传统的中值滤波方法要保留更多的边缘信息。在对同时带有高斯噪声和椒盐噪声的图像去噪时，模极大值链接的方法去噪效果非常突出，而且稳定