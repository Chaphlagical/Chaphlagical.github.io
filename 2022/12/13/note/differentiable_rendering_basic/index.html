<!DOCTYPE html><html lang="[&quot;en&quot;,&quot;zh-CN&quot;,&quot;default&quot;]" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>Physics Based Differentiable Rendering: Preliminaries | Chaf's Blog</title><meta name="author" content="Chaf Chen"><meta name="copyright" content="Chaf Chen"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="Basic introduction of physics based differentiable rendering">
<meta property="og:type" content="article">
<meta property="og:title" content="Physics Based Differentiable Rendering: Preliminaries">
<meta property="og:url" content="https://chaphlagical.github.io/2022/12/13/note/differentiable_rendering_basic/index.html">
<meta property="og:site_name" content="Chaf&#39;s Blog">
<meta property="og:description" content="Basic introduction of physics based differentiable rendering">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://chaphlagical.github.io/img/logo.jpg">
<meta property="article:published_time" content="2022-12-13T00:00:00.000Z">
<meta property="article:modified_time" content="2023-03-02T12:40:59.542Z">
<meta property="article:author" content="Chaf Chen">
<meta property="article:tag" content="Differentiable Rendering">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://chaphlagical.github.io/img/logo.jpg"><link rel="shortcut icon" href="/img/logo.jpg"><link rel="canonical" href="https://chaphlagical.github.io/2022/12/13/note/differentiable_rendering_basic/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"Traditional Chinese Activated Manually","cht_to_chs":"Simplified Chinese Activated Manually","day_to_night":"Dark Mode Activated Manually","night_to_day":"Light Mode Activated Manually","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Physics Based Differentiable Rendering: Preliminaries',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-03-02 12:40:59'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">Loading...</div></div></div><script>const preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',()=> { preloader.endLoading() })

if (false) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/logo.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">16</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">13</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">3</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="Chaf's Blog"><img class="site-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/logo.jpg"/><span class="site-name">Chaf's Blog</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">Physics Based Differentiable Rendering: Preliminaries</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2022-12-13T00:00:00.000Z" title="Created 2022-12-13 00:00:00">2022-12-13</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2023-03-02T12:40:59.542Z" title="Updated 2023-03-02 12:40:59">2023-03-02</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Note/">Note</a></span></div><div class="meta-secondline"></div></div></div><article class="post-content" id="article-container"><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2022/12/13/note/differentiable_rendering_basic/image-20221212220108088.png" alt="image-20221212220108088.png"></p>
<p>Differentiable rendering is the inverse problem of traditional rendering. Instead of rendering the image from given scene parameters, differentiable rendering trying to recover scene parameter from a given image. To do this, a common idea is using gradient based optimization methods like SGD, Adam, etc. An important part of gradient based optimization is calculating the derivative of the render result w.r.t. certain scene parameters.</p>
<p>In traditional physics based rendering, we have various methods like path tracing, bidirectional path tracing, photon mapping, etc to achieve great render result. These methods are all trying to solve the rendering equation described as below:</p>
<p>$$<br>    L_o(\pmb x,\omega_o,\lambda,t)&#x3D;L_e(\pmb x,\omega_o,\lambda,t)+\int_\Omega f_r(\pmb x,\omega_i,\omega_o,\lambda,t)L_i(\pmb x,\omega_i,\lambda,t)(\omega_i\cdot\pmb n)\mathrm d\omega_i<br>$$</p>
<p>Now we want to calculate the the derivative of the render result w.r.t. certain scene parameters like $\pi$, a straight forward way to solving the derivative of the rendering equation:</p>
<p>$$<br>    \frac{\partial}{\partial\pi}L_o(\pmb x,\omega_o,\lambda,t)&#x3D;\frac{\partial}{\partial\pi}L_e(\pmb x,\omega_o,\lambda,t)+\frac{\partial}{\partial\pi}\int_\Omega f_r(\pmb x,\omega_i,\omega_o,\lambda,t)L_i(\pmb x,\omega_i,\lambda,t)(\omega_i\cdot\pmb n)\mathrm d\omega_i<br>$$</p>
<p>In computer algebra, we can use automatic differentiation to solving the derivative of a computing process w.r.t. some parameters. In most case, automatic differentiation is quite well. However, using automatic differentiation requires the process to be smooth. In rendering task, many situations can break the smoothing condition, like geometry edges, object silhouettes, etc. Therefore, we need some special methods to handle this failed cases. Calculating derivative of the rendering equation correctly and fast is one of the most important parts of differentiable rendering.</p>
<p>Another important part of differentiable rendering is handle complex light transportation. We already have many light transport theorem to help us handle complex light transportation rendering like caustics, dispersion, subsurface scattering, volumetric rendering, etc. Simply using general differentiable rendering methods on these tasks may not always work well. Many researchers are working on this topic as well.</p>
<p>Since we have some basic methods to deal with differentiable rendering problem, what can it do next? A common application of differentiable rendering is scene reconstruction. Using the derivative of the rendering result w.r.t. some parameters waiting to be optimized, we can easily do some reconstruction tasks, like reconstructing geometry (optimizing vertex position&#x2F;SDF parameters), reconstructing material (optimizing BSDF parameters), reconstructing light condition (optimizing emissive parameters), etc. Due to the power of realistic rendering, physics based differentiable rendering can do somthing that other reconstruction methods can’t, like taking full use of indirect illumination.</p>
<h2 id="Reynolds-Transport-Theorem"><a href="#Reynolds-Transport-Theorem" class="headerlink" title="Reynolds Transport Theorem"></a>Reynolds Transport Theorem</h2><p>As we describe before, calculating the derivative of the rendering equation is solving:</p>
<p>$$<br>    \frac{\partial}{\partial\pi}L_o(\pmb x,\omega_o,\lambda,t)&#x3D;\frac{\partial}{\partial\pi}L_e(\pmb x,\omega_o,\lambda,t)+\frac{\partial}{\partial\pi}\int_\Omega f_r(\pmb x,\omega_i,\omega_o,\lambda,t)L_i(\pmb x,\omega_i,\lambda,t)(\omega_i\cdot\pmb n)\mathrm d\omega_i<br>$$</p>
<p>Assuming $I&#x3D;\int_{\mathcal X} f(x,\Theta)\mathrm dx&#x3D;\int_{\Omega} f_r(\pmb x,\omega_i,\omega_o,\lambda,t)L_i(\pmb x,\omega_i,\lambda,t)(\omega_i\cdot\pmb n)\mathrm d\omega_i$<br>If $f(x,\Theta)$ is smooth, we can easily apply:</p>
<p>$$<br>    \frac{\partial}{\partial\pi}\int_{\mathcal X} f(x,\Theta)\mathrm dx&#x3D;\int_{\mathcal X}\frac{\partial}{\partial \pi}f(x,\Theta)\mathrm dx<br>$$<br>However, $f(x,\Theta)$ is not always smooth due to visibility, etc. In these cases, we can’t straightly calculate the derivative of $f(x,\Theta)$.</p>
<p>Consider a simple case in 1D:</p>
<p>$$<br>    I&#x3D;\int_a^bf(x,\pi)\mathrm dx<br>$$<br>Where $b\leq x\leq a$, and $f(x)$ has discontinuties at $p_1(\pi),p_2(\pi),\cdots,p_n(\pi)$. Therefore, </p>
<p>$$<br>    \frac{\partial I}{\partial\pi}\neq \int_a^b\frac{\partial}{\partial\pi}f(x,\pi)\mathrm dx<br>$$<br>A trick to solve this problem is moving all discontinuties to the integral boundary, like:</p>
<p>$$<br>    I&#x3D;\int_a^{p_1(\pi)}f(x,\pi)\mathrm dx+<br>    \int_{p_1(\pi)}^{p_2(\pi)}f(x,\pi)\mathrm dx+\cdots+<br>    \int_{p_n(\pi)}^bf(x,\pi)\mathrm dx<br>$$<br>In this case, $f(x)$ become smooth in $[a,p_1(\pi)]$, $[p_1(\pi),p_2(\pi)]$, $\cdots$, $[p_n(\pi), b]$.</p>
<p>Based on Leibiniz integral rule, we know that</p>
<p>$$<br>    \frac{\partial}{\partial \pi}\int_{p_i(\pi)}^{p_{i+1}(\pi)}f(x,\pi)\mathrm dx&#x3D;f^-(p_{i+1}(\pi))\cdot\frac{\mathrm d}{\mathrm d\pi}p_{i+1}(\pi)-f^+(p_{i}(\pi))\cdot\frac{\mathrm d}{\mathrm d\pi}p_{i}(\pi)+\int_{p_i(\pi)}^{p_{i+1}(\pi)}\frac{\partial}{\partial \pi}f(x,\pi)\mathrm dx<br>$$<br>Assuming $a&#x3D;p_0(\pi)$, $b&#x3D;p_{n+1}(\pi)$, $\Delta f_i&#x3D;f^-(p_{i+1}(\pi))\cdot\frac{\mathrm d}{\mathrm d\pi}p_{i+1}(\pi)-f^+(p_{i}(\pi))\cdot\frac{\mathrm d}{\mathrm d\pi}p_{i}(\pi)$</p>
<p>$$<br>    \begin{aligned}<br>    \frac{\partial I}{\partial \pi}&amp;&#x3D;\sum_{i&#x3D;0}^{n+1}\left(f^-(p_{i+1}(\pi))\cdot\frac{\mathrm d}{\mathrm d\pi}p_{i+1}(\pi)-f^+(p_{i}(\pi))\cdot\frac{\mathrm d}{\mathrm d\pi}p_{i}(\pi)+\int_{p_i(\pi)}^{p_{i+1}(\pi)}\frac{\partial}{\partial \pi}f(x,\pi)\mathrm dx\right)\\<br>    &amp;&#x3D;\sum_{i&#x3D;0}^{n+1}\Delta f_i +\sum_{i&#x3D;0}^{n+1}\int_{p_i(\pi)}^{p_{i+1}(\pi)}\frac{\partial}{\partial \pi}f(x,\pi)\mathrm dx<br>    \end{aligned}<br>$$<br>We can see original equation is divided into two parts: interior term $\sum_{i&#x3D;0}^{n+1}\int_{p_i(\pi)}^{p_{i+1}(\pi)}\frac{\partial}{\partial \pi}f(x,\pi)\mathrm dx$ and boundary term $\sum_{i&#x3D;0}^{n+1}\Delta f_i$</p>
<p>We can generalize above deduction to three-dimensions to become Reynolds Transport theorem:</p>
<p>$$<br>    \frac{\partial}{\partial t}\int_{\Omega(t)}\pmb f\mathrm dV&#x3D;\int_{\Omega(t)}\frac{\partial\pmb f}{\partial t}\mathrm dV+\int_{\partial\Omega(t)}(\pmb v_b\cdot\pmb n)\pmb f\mathrm dA<br>$$</p>
<ul>
<li>Interior term: $\int_{\Omega(t)}\frac{\partial\pmb f}{\partial t}\mathrm dV$</li>
<li>Boundary term: $\int_{\partial\Omega(t)}(\pmb v_b\cdot\pmb n)\pmb f\mathrm dA$</li>
<li>$\pmb n(\pmb x,t)$ is the outward-pointing unit normal vector, $\pmb x$ is a point in the region and is the variable of integration</li>
<li>$\mathrm dV$ and $\mathrm dA$ are volume and surface elements at $\pmb x$</li>
<li>$v_b(\pmb x,t)$ is the velocity of the area element</li>
</ul>
<p>In differentiable rendering, interior term can be easily calculated by automatic differentiation, and the boundary term is not that easy. Most of the research focus on solving boundary term accurately and quickly, which I will write a series of notes for explaining the details.</p>
<h2 id="Automatic-Differentiation"><a href="#Automatic-Differentiation" class="headerlink" title="Automatic Differentiation"></a>Automatic Differentiation</h2><p>The key idea of automatic differentiation is the chain rule:</p>
<p>$$<br>    \frac{\partial z}{\partial \pmb x}&#x3D;\frac{\partial z}{\partial \pmb y}\cdot\frac{\partial \pmb y}{\partial \pmb x}<br>$$</p>
<p>Single variable case :</p>
<p>$$<br>    \begin{aligned}<br>        y&#x3D;f(x)\\\\<br>        z&#x3D;g(y)<br>    \end{aligned}<br>$$</p>
<pre><code class="highlight mermaid">graph LR 
	X--&gt;Y 
	Y--&gt;Z</code></pre>

<p>$$<br>    \begin{matrix}<br>        \dfrac{\mathrm dy}{\mathrm dx}&amp;\dfrac{\mathrm dz}{\mathrm dy}<br>    \end{matrix}<br>$$</p>
<p>Multiple variable case:</p>
<p>$$<br>    \begin{aligned}<br>        y&amp;&#x3D;f(x_0, x_1)\\\\<br>        z&amp;&#x3D;g(y)<br>    \end{aligned}<br>$$</p>
<pre><code class="highlight mermaid">graph LR
    X0--&gt;Y
    X1--&gt;Y
    Y--&gt;Z</code></pre>

<p>$$<br>\begin{aligned}<br>    \frac{\partial z}{\partial x_0}&amp;&#x3D;\frac{\partial z}{\partial y}\frac{\partial y}{\partial x_0}\\\\<br>    \frac{\partial z}{\partial x_1}&amp;&#x3D;\frac{\partial z}{\partial y}\frac{\partial y}{\partial x_1}<br>\end{aligned}<br>$$</p>
<p>We can see the result $\partial z&#x2F;\partial y$ can be reused. Therefore, for a complex computing process, we can construct a compute graph, searching for the best path to calculate the derivative using chain rule.</p>
<p>There are two ways to execute automatic differentiation: forward mode and reverse mode</p>
<p><strong>Forward Mode</strong></p>
<pre><code class="highlight mermaid">graph LR
    W0--&gt;X
    W1--&gt;X
    W2--&gt;X
    W0--&gt;Y0
    X--&gt;Y0
    X--&gt;Y1
    Y0--&gt;Z
    Y1--&gt;Z</code></pre>

<p>Forward mode automatic differentiation start from the beginning of the compute graph, and propagate the derivative forward. Assuming we want to calculate $\partial z&#x2F;\partial w_0$ form the compute graph above, we do:</p>
<p>$$<br>\begin{aligned}<br>    W0:&amp;\frac{\partial w_0}{\partial w_0}&#x3D;1\\\<br>    W1:&amp;\frac{\partial w_1}{\partial w_0}&#x3D;0\\\<br>    W2:&amp;\frac{\partial w_2}{\partial w_0}&#x3D;0\\\<br>    X:&amp;\frac{\partial x}{\partial w_0}\\\<br>    Y0:&amp;\frac{\partial y_0}{\partial w_0}&#x3D;\frac{\partial y_0}{\partial x}\frac{\partial x}{\partial w_0}+\frac{\partial y_0}{\partial w_0}\\\<br>    Y1:&amp;\frac{\partial y_1}{\partial w_0}&#x3D;\frac{\partial y_1}{\partial x}\frac{\partial x}{\partial w_0}\\\<br>    Z:&amp;\frac{\partial z}{\partial w_0}&#x3D;\frac{\partial z}{\partial y_0}\frac{\partial y_0}{\partial w_0}+\frac{\partial z}{\partial y_1}\frac{\partial y_1}{\partial w_0}<br>\end{aligned}<br>$$</p>
<p><strong>Reverse Mode</strong></p>
<pre><code class="highlight mermaid">graph LR
    W0--&gt;X
    W1--&gt;X
    W2--&gt;X
    W0--&gt;Y0
    X--&gt;Y0
    X--&gt;Y1
    Y0--&gt;Z
    Y1--&gt;Z</code></pre>

<p>Reverse mode automatic differentiation start from the end of the compute graph, and propagate the derivative backward. Like the compute graph above, start from $z$, we have:</p>
<p>$$<br>\begin{aligned}<br>    Y0:&amp;\frac{\partial z}{\partial y_0}\\\\<br>    Y1:&amp;\frac{\partial z}{\partial y_1}\\\\<br>    X:&amp;\frac{\partial z}{\partial x}&#x3D;\frac{\partial z}{\partial y_0}\frac{\partial y_0}{\partial x}+\frac{\partial z}{\partial y_1}\frac{\partial y_1}{\partial x}\\\\<br>    W0:&amp;\frac{\partial z}{\partial w_0}&#x3D;\frac{\partial z}{\partial y_0}\frac{\partial y_0}{\partial w_0}+\frac{\partial z}{\partial x}\frac{\partial x}{\partial w_0}\\\\<br>    \cdots<br>\end{aligned}<br>$$</p>
<p>In differentiable rendering, reverse mode automatic differentiation is used for optimization and forward mode automatic differentiation is used for gradient visualization.</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><h3 id="Reasearcher-amp-Lab"><a href="#Reasearcher-amp-Lab" class="headerlink" title="Reasearcher &amp; Lab"></a>Reasearcher &amp; Lab</h3><p><a target="_blank" rel="noopener" href="https://shuangz.com/">Prof. Shuang Zhao</a></p>
<p><a target="_blank" rel="noopener" href="https://rgl.epfl.ch/">EPFL’s Realistic Graphics Lab(Prof. Wenzel Jakob’s Group)</a></p>
<p><a target="_blank" rel="noopener" href="https://people.csail.mit.edu/sbangaru">Sai Praveen Bangaru</a></p>
<p><a target="_blank" rel="noopener" href="https://cseweb.ucsd.edu/~tzli/">Tzu-Mao Li</a></p>
<p><a target="_blank" rel="noopener" href="https://cseweb.ucsd.edu/~ravir/">Ravi Ramamoorthi</a></p>
<p><a target="_blank" rel="noopener" href="https://sites.cs.ucsb.edu/~lingqi/">Lingqi Yan</a></p>
<h3 id="Course"><a href="#Course" class="headerlink" title="Course"></a>Course</h3><p>Siggraph Course 2020: <a target="_blank" rel="noopener" href="https://shuangz.com/courses/pbdr-course-sg20/">Physics-Based Differentiable Rendering A Comprehensive Introduction</a></p>
<p>CVPR Tutorial 2021: <a target="_blank" rel="noopener" href="https://www.diff-render.org/">Physics-Based Differentiable Rendering</a></p>
<h3 id="Tool"><a href="#Tool" class="headerlink" title="Tool"></a>Tool</h3><p><a target="_blank" rel="noopener" href="https://github.com/mitsuba-renderer/mitsuba2">Mitsuba2</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/mitsuba-renderer/mitsuba3">Mitsuba3</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/mitsuba-renderer/enoki">enoki</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/mitsuba-renderer/drjit">drjit</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/uci-rendering/psdr-cuda">PSDR</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/BachiLi/redner">redner</a></p>
<h3 id="Paper"><a href="#Paper" class="headerlink" title="Paper"></a>Paper</h3><p><a target="_blank" rel="noopener" href="https://cseweb.ucsd.edu/~tzli/diffrt/">Differentiable Monte Carlo Ray Tracing through Edge Sampling</a> SIGGRAPH Asia 2018</p>
<p>TODO</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="https://chaphlagical.github.io">Chaf Chen</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://chaphlagical.github.io/2022/12/13/note/differentiable_rendering_basic/">https://chaphlagical.github.io/2022/12/13/note/differentiable_rendering_basic/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Differentiable-Rendering/">Differentiable Rendering</a></div><div class="post_share"><div class="social-share" data-image="/img/logo.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/12/14/note/edge_sampling/" title="Physics Based Differentiable Rendering: Edge Sampling"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">Physics Based Differentiable Rendering: Edge Sampling</div></div></a></div><div class="next-post pull-right"><a href="/2022/03/18/gaming/god_of_war_4/" title="God of War IV"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">God of War IV</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2022/12/14/note/edge_sampling/" title="Physics Based Differentiable Rendering: Edge Sampling"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-14</div><div class="title">Physics Based Differentiable Rendering: Edge Sampling</div></div></a></div><div><a href="/2022/12/17/paper_reading/Vectorization_for_Fast_Analytic_and_Differentiable_Visibility/" title="Vectorization for Fast, Analytic, and Differentiable Visibility"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-17</div><div class="title">Vectorization for Fast, Analytic, and Differentiable Visibility</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comment</span></div></div><div class="comment-wrap"><div><div id="disqus_thread"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/logo.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Chaf Chen</div><div class="author-info__description">USTC CG Student</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">16</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">13</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">3</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Chaphlagical"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/Chaphlagical" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:mail@ustc.edu.cn" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">Looking for a Ph.D position!</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Introduction"><span class="toc-number">1.</span> <span class="toc-text">Introduction</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reynolds-Transport-Theorem"><span class="toc-number">2.</span> <span class="toc-text">Reynolds Transport Theorem</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Automatic-Differentiation"><span class="toc-number">3.</span> <span class="toc-text">Automatic Differentiation</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reference"><span class="toc-number">4.</span> <span class="toc-text">Reference</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Reasearcher-amp-Lab"><span class="toc-number">4.1.</span> <span class="toc-text">Reasearcher &amp; Lab</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Course"><span class="toc-number">4.2.</span> <span class="toc-text">Course</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Tool"><span class="toc-number">4.3.</span> <span class="toc-text">Tool</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Paper"><span class="toc-number">4.4.</span> <span class="toc-text">Paper</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/01/25/paper_reading/Adaptive_Incident_Radiance_Field_Sampling_and_Reconstruction_Using_Deep_Reinforcement_Learning/" title="Adaptive Incident Radiance Field Sampling and Reconstruction Using Deep Reinforcement Learning">Adaptive Incident Radiance Field Sampling and Reconstruction Using Deep Reinforcement Learning</a><time datetime="2023-01-25T00:04:00.000Z" title="Created 2023-01-25 00:04:00">2023-01-25</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/01/06/paper_reading/Temporal_Coherence-Based_Distributed_Ray_Tracing_of_Massive_Scenes/" title="Temporal Coherence-based Distributed Ray Tracing of Massive Scenes">Temporal Coherence-based Distributed Ray Tracing of Massive Scenes</a><time datetime="2023-01-06T22:13:11.000Z" title="Created 2023-01-06 22:13:11">2023-01-06</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/12/29/gaming/spiderman_miles/" title="Marvel's Spider-Man Miles Morales">Marvel's Spider-Man Miles Morales</a><time datetime="2022-12-29T21:13:11.000Z" title="Created 2022-12-29 21:13:11">2022-12-29</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/12/17/paper_reading/Vectorization_for_Fast_Analytic_and_Differentiable_Visibility/" title="Vectorization for Fast, Analytic, and Differentiable Visibility">Vectorization for Fast, Analytic, and Differentiable Visibility</a><time datetime="2022-12-17T21:13:11.000Z" title="Created 2022-12-17 21:13:11">2022-12-17</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/12/14/note/edge_sampling/" title="Physics Based Differentiable Rendering: Edge Sampling">Physics Based Differentiable Rendering: Edge Sampling</a><time datetime="2022-12-14T00:00:00.000Z" title="Created 2022-12-14 00:00:00">2022-12-14</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By Chaf Chen</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="Scroll To Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container').forEach(node => {
            if (node.hasAttribute('display')) {
              btf.wrap(node, 'div', { class: 'mathjax-overflow' })
            } else {
              btf.wrap(node, 'span', { class: 'mathjax-overflow' })
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typesetPromise()
}</script><script>(() => {
  const $mermaidWrap = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaidWrap.length) {
    window.runMermaid = () => {
      window.loadMermaid = true
      const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

      Array.from($mermaidWrap).forEach((item, index) => {
        const mermaidSrc = item.firstElementChild
        const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
        const mermaidID = 'mermaid-' + index
        const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent
        mermaid.mermaidAPI.render(mermaidID, mermaidDefinition, (svgCode) => {
          mermaidSrc.insertAdjacentHTML('afterend', svgCode)
        })
      })
    }

    const loadMermaid = () => {
      window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaid)
    }

    window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
  }
})()</script><script>function loadDisqus () {
  var disqus_config = function () {
    this.page.url = 'https://chaphlagical.github.io/2022/12/13/note/differentiable_rendering_basic/'
    this.page.identifier = '/2022/12/13/note/differentiable_rendering_basic/'
    this.page.title = 'Physics Based Differentiable Rendering: Preliminaries'
  };

  window.disqusReset = () => {
    DISQUS.reset({
      reload: true,
      config: disqus_config
    })
  }

  if (window.DISQUS) disqusReset()
  else {
    (function() { 
      var d = document, s = d.createElement('script');
      s.src = 'https://chaphlagical-github-io.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  }

  document.getElementById('darkmode').addEventListener('click', () => {
    setTimeout(() => window.disqusReset(), 200)
  })
}

if ('Disqus' === 'Disqus' || !false) {
  if (false) btf.loadComment(document.getElementById('disqus_thread'), loadDisqus)
  else loadDisqus()
} else {
  function loadOtherComment () {
    loadDisqus()
  }
}
</script></div></div></body></html>