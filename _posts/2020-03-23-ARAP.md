---
layout: post
title: As Rigid as possible Parameterization
subtitle: USTC CG Course 2020
thumbnail-img: /assets/images/thumbnail-img/arap.png
cover-img: /assets/images/cover-img/CG.png
comments: true
gh-repo: Chaphlagical/USTC_CG
gh-badge: [star, fork, follow]
tags: [CG, Geometry]
readtime: true
---

As similar as possible (ASAP) and as rigid as possible (ARAP) Parameterization Algorithm.

## Feature

* ASAP (As-similar-as-possible) Parameterization
* ARAP (As-rigid-as-possible) Parameterization

## Development Environment

* **IDE**: Microsoft Visual Studio 2019 community
* **Build**: CMake 3.16.3
* **GUI Platform**: Qt 5.14.1
* **other 3rd Party Library**: Eigen 3.3.7, Assimp 5.0.1, tinyxml2 8.0.0

## Algorithm Introduction

### Basic Method

The basic steps of non-fixed boundary parameterization: congruently map each triangle of the three-dimensional triangle grid onto a two-dimensional plane, and merge each triangle into a two-dimensional grid by using a suitable algorithm (as shown in the figure below)

![bg](https://chaphlagical.github.io/assets/images/assets-img/ARAP/bg.png){: .mx-auto.d-block :}

Finding optimized mapping is equivalent to solving following energy function:

$$
E(u,L)=\sum\limits^T_{t=1}A_t\|J_t(u)-L_t\|^2_F
$$

$L_t$ is the linear transformation of each triangle, every $L_t$ has similar structure.

When the transformation is similar transformation, $L_t$ can be represented as following:

$$
M=\left\{\begin{bmatrix}a&b\\-b&a\end{bmatrix}:a,b\in \boldsymbol R \right\}
$$

When the transformation is congruent transformation, $L_t$ can be represented as following:

$$
M=\left\{\begin{bmatrix}\cos\theta&\sin\theta\\-\sin\theta&\cos\theta\end{bmatrix}:\theta\in [0,2\pi) \right\}
$$

Energy function can be rewritten as:

$$
E(u,L)=\frac{1}{2}\sum\limits^T_{t=1}\sum\limits^2_{i=0}\cot(\theta_t^i)\|(u^i_t-u_t^{i+1})-L_t(x_t^i-x_t^{i+1})\|^2
$$

The goal is to solve optimization problem:

$$
(u,L)=\arg\min_{(u,L)}E(u,L)\ \ s.t.\ \ L_t\in M
$$

### ASAP Global Solution

Set $L_t$ to:

$$
M=\left\{\begin{bmatrix}a&b\\-b&a\end{bmatrix}:a,b\in \boldsymbol R \right\}
$$

At this time, $\theta_t^i$ and $x_t^i$ are already known, we can use $a$, $b$ and $u$ as unknown variable to setup sparse linear equations for solving optimization problem. 

### Local/Global Method

**Optimized $L_t$-Fitting Matrix**

Using SVD decomposition, we can decompose matrix $J$ into:

$$
J=U\Sigma V^T
$$

For congruent mapping, the fitting matrix of $L$ is:

$$
L=UV^T
$$

which is singular value equal to zero. When we need to use similar mapping, singular value set to $(\sigma_1+\sigma_2)/2$

**Local Phase**

Using two dimension triangle and current estimated coordiantes to estimate $J_t(u)$

$$
J_t(u)\sim S_t(u)=\sum\limits_{t=0}^2 \cot(\theta_t^i)(u_t^i-u_t^{i+1})(x_t^i-x_t^{i+1})^T
$$

**Global Phase**

Iteratively solve the new estimated coordinates:

$$
\begin{aligned}

&\sum\limits_{j\in N(t)}[\cot(\theta_{ij})+\cot(\theta_{ji}(u_i-u_j)\\

&=\sum\limits_{j\in N(t)}[\cot(\theta_{ij})L_{t(i,j)}+\cot(\theta_{ji}L_{t(j,i)})(x_i-x_j)\\

&\forall t=1,\cdots,n

\end{aligned}
$$

**Initialization**

Using Local/Global method needs initialization, we can use fix boundary parameterization as initial parameter coordinates.

## Demo

|     Original Surface      |                       Original Mesh                        |           Parameterize Mesh           |             Texture              |
| :-----------------------: | :--------------------------------------------------------: | :-----------------------------------: | :------------------------------: |
| ![](https://chaphlagical.github.io/assets/images/assets-img/ARAP/ball.png)  | <img src="https://chaphlagical.github.io/assets/images/assets-img/ARAP/ball_mesh.png" style="zoom:150%;" />  | ![](https://chaphlagical.github.io/assets/images/assets-img/ARAP/ball_ARAP_3_mesh.png)  | ![](https://chaphlagical.github.io/assets/images/assets-img/ARAP/ball_ARAP_3.png)  |
| ![](https://chaphlagical.github.io/assets/images/assets-img/ARAP/bunny.png) | <img src="https://chaphlagical.github.io/assets/images/assets-img/ARAP/bunny_mesh.png" style="zoom:150%;" /> | ![](https://chaphlagical.github.io/assets/images/assets-img/ARAP/bunny_ARAP_3_mesh.png) | ![](https://chaphlagical.github.io/assets/images/assets-img/ARAP/bunny_ARAP_3.png) |
|  ![](https://chaphlagical.github.io/assets/images/assets-img/ARAP/cow.png)  |  <img src="https://chaphlagical.github.io/assets/images/assets-img/ARAP/cow_mesh.png" style="zoom:100%;" />  |  ![](https://chaphlagical.github.io/assets/images/assets-img/ARAP/cow_ARAP_3_mesh.png)  |  ![](https://chaphlagical.github.io/assets/images/assets-img/ARAP/cow_ARAP_3.png)  |
| ![](https://chaphlagical.github.io/assets/images/assets-img/ARAP/grag.png)  | <img src="https://chaphlagical.github.io/assets/images/assets-img/ARAP/grag_mesh.png" style="zoom:100%;" />  | ![](https://chaphlagical.github.io/assets/images/assets-img/ARAP/garg_ARAP_3_mesh.png)  | ![](https://chaphlagical.github.io/assets/images/assets-img/ARAP/garg_ARAP_3.png)  |
| ![](https://chaphlagical.github.io/assets/images/assets-img/ARAP/iris.png)  | <img src="https://chaphlagical.github.io/assets/images/assets-img/ARAP/iris_mesh.png" style="zoom:100%;" />  | ![](https://chaphlagical.github.io/assets/images/assets-img/ARAP/iris_ARAP_3_mesh.png)  | ![](https://chaphlagical.github.io/assets/images/assets-img/ARAP/iris_ARAP_3.png)  |

### Demo Video

<video width="100%" height="100%" id="video" controls="" preload="none" poster="">
      <source id="mp4" src="./ARAP/video/demo.mp4" type="video/mp4">
      </video>

## Resource

**Project**: [https://github.com/Chaphlagical/USTC_CG/tree/master/Homeworks/5_ARAP](https://github.com/Chaphlagical/USTC_CG/tree/master/Homeworks/5_ARAP)

## Reference

*[1] Ligang Liu, Lei Zhang, Yin Xu, Craig Gotsman, and Steven J Gortler. A local/global approach to mesh parameterization. In Computer Graphics Forum, volume 27, pages 1495â€“1504. Wiley Online Library, 2008.*