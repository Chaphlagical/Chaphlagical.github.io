---
title: 微机原理与嵌入式系统概论
tags: 微机原理与嵌入式系统
article_header:
  type: cover
  image:
    src: /assets/images/embed.jpg
---

<!--more-->

## (一) 计算机的发展简史

### 1、计算机的诞生

* Charles Babbage：差分机和分析机

* Alan Turing：图灵机
* Goldstine, Eckert, Mauchly：ENIAC
* John v. Neumann：EDVAC
	* 确定计算机五个构成部分：计算器CA，逻辑控制装置CC，存储器M，输入I，输出O
	* 改进
		* 二进制
		* 存储程序
		* 程序执行顺序可通过“条件转移”指令自动完成
* M. Wilkes：EDSAC
	* 第一台存储程序式电子计算机

### 2、现代计算机的发展历程

* **第一阶段**：电子管阶段
	* 计算机体积庞大，功耗大，可靠性低，售价昂贵
	* 主要用在重要场合的科学计算和数据处理
* **第二阶段**：晶体管时代
	* 内存采用磁芯，外存采用磁带或磁鼓，减小体积，降低功耗，提高可靠性，降低成本
	* 运算速度提高，出现了高级程序设计语言，计算机开始进入工业过程控制领域
* **第三阶段**：集成电路时代
	* 计算机体积进一步减小，可靠性进一步提高，成本进一步降低，速度大大提高
	* 操作系统逐渐成熟，应用扩大
* **第四阶段**：LSI&VLSI时代
	* LSI和VLSI得到广泛使用，内存普遍采用半导体存储器，外存采用磁盘、磁带和光盘
	* 体积进一步缩小，性能和可靠性进一步提高，成本进一步降低
	* 应用日益广泛
* **第五阶段**：ULSI&GSI时代
	* 流水线、超标量、多线程、多内核、多CPU和新型高速总线技术使得普通PC机的速度可达每秒数十亿次
	* 更加注重多媒体信息和并行数据处理能力
	* 单片机和嵌入式系统性能不断提高，应用领域不断扩大
	* 现代计算机是云计算、大数据、物联网、移动互联网和人工智能等技术发展的最重要基础

### 3、计算机的类型

* **微型计算机**
	* 台式计算机
	* 个人工作站
	* 笔记本电脑
	* 平板电脑
* **服务器**
	* 采用Unix操作系统的小型机（服务器）
	* 采用Intel架构的x86服务器
* **嵌入式计算机**
	* 集成到应用对象中的专用计算机，以自动监测与控制应用对象的物理过程
	* 服务与特定目的，不属于通用计算机
* **超级计算机**
	* 提供最高的计算性能，最昂贵、物理上最大型的计算机
	* 广泛用于复杂过程仿真等科学计算领域

## (二) 计算机系统的组成

* **硬件**：构成计算机的物理部件
* **软件**：按特定顺序组织的指令和数据集合

<img src="/assets/images/概论.assets/image-20200218211251696.png" alt="image-20200218211251696" style="zoom:80%;" />

### 1、计算机硬件

#### (1) 组成结构

* 存储器
* 运算器
* 控制器
* 输入设备
* 输出设备

此外还需将五个部件进行互连的总线和适配器

<img src="/assets/images/概论.assets/image-20200218213953637.png" alt="image-20200218213953637" style="zoom:80%;" />

#### (2) 存储器

* **主要功能**：存储程序和数据
* **主要类型**：分为主存储器和辅助存储器
	* **主存储器**
		* 简称主存或内存，由半导体材料构成，每个单元存储1位二进制信息，单位为1个比特(bit)
		* 8bit组成1个字节(Byte)
		* 字节是存储器存储和读取数据的基本单位，每个字节都有唯一的物理地址(PA)
		* 若干字节构成一个字，每个字所包含的位数称为计算机的字长
		* 典型的字长有16位、32位和64位
	* **辅助存储器**
		* **主存特点**：读写速度相对较快，价格高、容量受限、掉电后RAM存储的信息消失
		* **辅存特点**：读写速度慢，价格低，容量大、具有非易失性，又称为外存
		* 常见**外存**包括：
			* 基于磁介质极化的磁盘和磁带
			* 基于表面几何微观形状的光盘
			* 基于半导体的闪存

#### (3) 运算器

* **主要功能**：完成各种数据运算和处理
* **主要构成**：算术逻辑单元ALU和寄存器阵列
	* ALU负责实现算术或逻辑运算，如加、减、乘、除、移位或比较大小等
	* 寄存器是运算器内部的高速存储单元，访问速度最快
	* 每个寄存器容量通常是一个字，也就是计算机的字长
	* 受芯片面积限制，寄存器的数量不会很多
	* 运算器工作时，需要处理的数据（操作数）先被送到某个寄存器中暂存，运算过程中的临时数据或者处理后的结果也暂存在特定的寄存器中

#### (4) 控制器

* 计算机的指挥控制中心
* **主要功能**：根据指令对计算机各部件进行操控，协调各部件有序工作
* **主要构成**：
	* 指令寄存器IR
	* 指令译码器ID
	* 操作控制器OC
* VLSI出现后，运算器和控制器被集成到CPU中
* CPU与主存是计算机的核心部分

#### (5) 输入设备

* **主要功能**：将信息进行编码后输入计算机
* 最常用的输入设备：键盘和鼠标
* 用于人机交互的输入设备：
	* 触摸屏、操纵杆、轨迹球、麦克风、游戏机手柄……
* 其他输入设备
	* 扫描仪、证件读卡器、摄像头等

#### (6) 输出设备

* **主要功能**：向外界输出计算机处理后的结果
* 有些兼具输入和输出功能，如触摸屏和计算机通信设备，简称I/O设备，外村也可以看作是一种I/O设备
* **特点**：种类繁多、信息格式各异、速度快慢不一
* 慢速设备：打印机、绘图机、扬声器、……
* 高速设备：外存、数据通信设备、超高清显示器、数字波形合成器、……

#### (7) 适配器

* **主要功能**：在计算机与和外设之间进行桥接和匹配
	* 数据缓冲，解决速度不匹配问题
	* 信息转换，解决编码格式不同的问题
	* 电平转换，解决电平不一致问题
	* 状态监测，收发双方的相互沟通
	* 时序控制，协调外设和主机并行工作
* 多个不同种类的外设，需要多个接口

#### (8) 总线

* **主要功能**：实现各部件之间的信息传输和交换
* 按用途分为三类：
	* 数据总线DB：双向
	* 地址总线AB：单向
	* 控制总线CB：有些单向有些双向

<img src="/assets/images/概论.assets/image-20200218225221249.png" alt="image-20200218225221249" style="zoom: 67%;" />

### 2、计算机软件

按特定顺序组织的计算机数据和指令的集合，可分为：

**系统软件**

* 控制和管理计算机工作并且无需用户干预的各种程序集合。主要功能是调度、监控和维护计算机运行，管理各种部件，协调各种资源
* 系统软件的核心是操作系统，负责管理硬件与软件资源、控制I/O设备和网络、维护文件系统、提供用户接口UI

**应用软件**

* 利用计算机解决特定问题而编程开发的各种程序

#### 计算机软件的发展与演进

* 第一代 1846~1953
	* 机器语言
	* 汇编语言
* 第二代 1954~1964
	* 算法语言
	* Fortran
	* LISP
	* ALGOL
	* BASIC
* 第三代 1965~1970
	* 多用户多任务操作系统
	* 数据库技术
	* 软件工程
* 第四代 1971~1989
	* 结构化程序设计思想
	* PASCAL
	* C语言
	* 多媒体技术
* 第五代 1990~至今
	* GUI和OA软件
	* 面向对象技术
	* 万维网
	* 分布式架构
	* API
	* 软件定义一切

## (三) 计算机中数的表示方法

### 1、进位计数制

* 10进制：$456D=456=4\times 10^2+5\times10^1+6\times 10^0$
* 二进制：$10110B=1\times2^4+0\times2^3+1\times2^2+1\times2^1+0\times2^0 $
* 16进制：$0\sim 15,\ 0123456789ABCDEF\\32AEh=3\times16^3+2\times16^2+10\times16^1+14\times16^0$
	* 数字后加$H$或$h$以示区别
	* 以$A\sim F$等字母开头的十六进制数，应在字母前加0
	* 十六进制数的加、减运算法则
		* 加法运算：逢16进1
		* 减法运算：借1当16

* 位、字节、字和字长：$n$位计算机的字长为$n$ bit
	* 16位计算机字长为2个字节，32位计算机字长为4字节

### 2、有符号数的原码、反码和补码表示

* 有符号数和无符号数
	* 在计算机中，可以区分正负的类型称为有符类型，无正负的类型（只有正值）称为无符类型
* 数值编码：在计算机中将正负数进行合理表示
	* 机器数：二进制形式表示的数据
	* 真值：机器数所代表的数值
* 三种编码表示方式：原码、反码和补码
	* 计算机中使用补码表示有符号数，可用加法器实现减法运算

#### (1) 原码编码方案

* **约定**：数值$x$的原码记为$[x]_原$，若机器（处理器）字长为$n$位，那么数值$x$的原码定义为：
	$$
	[x]_原=
	\begin{align}
	\begin{cases}
	x&0\leq x\leq 2^{n-1}-1\\\\
	2^{n-1}+|x|&-(2^{n-1}-1)\leq x\leq 0
	\end{cases}
	\end{align}
	$$

	* 最高位为符号位：0为正数，1为负数，其余为绝对值

	* n bit原码可表示的数值范围是：$-(2^{n-1}-1)\sim 2^{n-1}-1$

	* 例：8位有符号二进制数：
		$$
		\begin{align}
		0000\ 0001\to +1\ \ & \ \ 0111\ 1111\to +127\\
		1000\ 0001\to -1\ \ & \ \ 1111\ 1111\to -127\\
		0000\ 0000\to +0\ \ & \ \ 1000\ 0000\to -0
		\end{align}
		$$

* 原码表示的0有正负之分，习惯上将0用+0表示

* 原码存在的**问题**：

	* 原码表示的有符号数在运算时会出现错误

		<img src="/assets/images/概论.assets/image-20200220164513353.png" alt="image-20200220164513353" style="zoom:50%;" />

	* **原因**：在运算过程中，符号位也参与了运算

(2) 反码编码方案

* **约定**：数值$x$的反码记为$[x]_反$，若机器（处理器）字长为$n$位，那么数值$x$的反码定义为：
	$$
	[x]_反=
	\begin{cases}
	x&0\leq x\leq 2^{n-1}-1\\
	(2^n-1)-|x|&-(2^{n-1}-1)\leq x\leq 0
	\end{cases}
	$$

	* n bit反码可表示的数值范围为：$-(2^{n-1}-1)\sim 2^{n-1}-1$
	* 整数的反码与原码相同；负数的反码符号位为1，其余各位与原码相反
	* 反码表示的0有正负之分，习惯上将0用+0表示
	* 使用反码表示数据，在运算时符号位也参与运算，故计算机未采用反码

#### (3) 补码编码方案

* **约定**：数值$x$的补码记为$[x]_补$，若机器（处理器）字长为$n$位，那么数值$x$的补码定义如下：
	$$
	[x]_补=\begin{cases}x&0\leq 2^{n-1}-1\\2^n-|x|&-2^{n-1}\leq x\leq 0 \end{cases}
	$$

* 正数的补码与原码完全相同

* 负数的补码用模$2^n$的补数$2^n-|x|$的二进制编码表示

	* 求一个负数的补码时，可先求出该负数的反码，然后加1即可
	* 另一种方法，求负数绝对值的原码，然后从低位向高位扫描，将遇到的首个1以及之前的0保持不变，对之后的各位按位取反

* 补码运算

	* 对于有符号数$p$和$q$有：
		$$
		\begin{align}
		[p+q]_补&=[p]_补+[q]_补\\ 
		[p-q]_补&=[p]_补-[q]_补=[p]_补+[-q]_补
		\end{align}
		$$

	* 采用补码运算的前提：结果不能发生溢出（结果超出了补码所能表示的范围）

		<img src="/assets/images/概论.assets/image-20200220173923015.png" alt="image-20200220173923015" style="zoom:33%;" />

		<img src="/assets/images/概论.assets/image-20200220173952595.png" alt="image-20200220173952595" style="zoom:33%;" />

	* **结论**：若记符号位向前进位为CP，次高位向前进位为CF，当且仅当$CP\bigoplus CF=1$时，结果发生溢出

	* **推论**：

		* 若参加运算的二进制数被看成无符号数，没有符号位，加减运算结果可能会有进位或借位，没有溢出问题
		* 若参加运算的二进制数被看成有符号数，运算结果受到最大表示范围的限制，超出则出现溢出，结果错误
		* 有符号数运算必须判断是否出现溢出，如果出现溢出只能重新设计算法

### 3、定点数和浮点数

* 定点数：采用定点格式表示的数据，能够表示的数值范围较小，所需的硬件电路较简单

	* 定点格式：小数点位置固定不变，无需再用符号表示
	* 现代计算机中多采用定点纯整数，定点数称为整数

* 浮点数：采用浮点格式表示的数据，可以表示的数值范围很大，所需的硬件电路较复杂

	* 浮点格式：有效数字和数值范围（比例因子）分别表示，小数点位置将随比例因子不同在一定范围内浮动

	* 任意一个二进制数$N$也可以表示为：$N=M\times 2^e$

		* $M$—浮点数尾数，$e$—浮点数阶码

		* IEEE-754规定的浮点数格式

			![image-20200220174617041](/assets/images/概论.assets/image-20200220174617041-1582767900491.png)

### 4、其他信息编码

#### (1) BCD编码

* **4位二进制表示1位十进制数**，最常用的是8421 BCD码，简称BCD码

* 例如：10进制数135，其BCD码位0001 0011 0101

* 计算机以字节为基本存储单位，有两种BCD码表示方法

	* 压缩BCD码：一个字节表示2位十进制数
		* 例如：十进制数89D的压缩BCD码为：1000 1001B
	* 非压缩BCD码：一个字节仅用来表示一位BCD码，其中低4位表示0~9，高4位为0
		* 例如：十进制数89D的非压缩BCD码需要使用两个字节：0000 1000B和0000 1001B

* 存在的问题

	* 每4位二进制数可以表示成16种状态，但是BCD码只使用其中的10个，二进制数状态空间利用率低

	* 计算机对数据运算均按照二进制运算规则将带来问题

		* 例如：7+5用非压缩BCD码计算

			$0000\ 0111b+0000\ 0101b=0000\ 1100b(\neq 12D=0001\ 0010b)$

		* 错误原因：使用二进制运算法则计算BCD码

		* 解决方法：BCD码运算后必须对结果进行调整

#### (2) ASCII码—美国信息交换标准代码

* ASCII等同于国际标准的7单位制IRA码
	* 用于给西文字符编码，由7位二进制数组合而成，可以表示128种字符
	* 在ASCII码中，按其作用可分为
		* 34个控制字符
		* 10个阿拉伯数字
		* 52个英文大小写字母
		* 32个专用符号

### 5、字符串的表示方法

* 字符串：一串连续字符，在内存中占用连续多个字节，每个字节存放一个字符

* 字长为多字节的计算机，一个字可存放多个字符

* 不同类型的计算机，一个字有两种字符存放顺序

	* 第一种：从**高位字节向低位字节**顺序存放

	* 第二种：从**低位字节向高位字节**顺序存放

		![image-20200220201000399](/assets/images/概论.assets/image-20200220201000399-1582767900492.png)

## (四) 嵌入式系统简介

### 1、嵌入式系统的基本概念

* Embedded System：嵌入式计算机系统的简称
* IEEE定义：嵌入式系统是用于控制、监视或者辅助设备、机器和车间运行的装置
* 中国大陆定义：以应用为中心、以计算机技术为基础，软件硬件可裁剪，适应应用系统对功能、可靠性、成本、体积、功耗严格要求的专用计算机系统

### 2、嵌入式系统的硬件

* 主要包括：
	* 嵌入式微处理器（核心）
		* 有MPU，MCU，DSP和SOC之分
	* 存储器（外存多采用半导体非易失存储器，如flash）
	* 嵌入式外围设备
	* I/O接口

#### (1) EMPU：嵌入式微处理器

* Embedded Microprocessor Unit，通常简称为MPU
* 原理和功能和通用微处理器相同
* MPU没有存储器和外设接口
	* 使用MPU构建嵌入式系统需要外接存储器和I/O接口芯片
	* 如果所有器件安装在一块主板上—单板机
	* 单板机特点：
		* 与传统工控机相比，集成度高、成本低、功耗小和可靠性高
		* 板上芯片、总线、结构呈裸露状态，技术保密性差

#### (2) EMCU：嵌入式微控制器

* Embedded Microcontroller Unit，通常简称为MCU
* 将计算机的主要部件，如ROM、RAM、总线控制逻辑和中断控制器，以及可能需要的定时/计数器，并/串接口、看门狗、ADC和DAC等集成在一块芯片上，构成一个功能相对完整的计算机系统，又称为单片机
* 特点：集成度高，产品开发周期短，成本低廉，功能丰富，功耗小和可靠性高

#### (3) DSP：数字信号处理器

* Digital Signal Processor，专门用于数字信号处理
	* 通过内部硬件电路和专门的DSP指令，快速实现各种高强度数字信号处理，广泛用于数字滤波、信号特征分析、电子对抗、音视频编/解码等领域
* 有非嵌入式和嵌入式、定点和浮点之分
	* 非嵌入式：独立的芯片，需要与其他处理器通过总线互连，具有较高的处理能力
	* 嵌入式：作为一个功能部件，被集成到MCP中
	* 定点DSP的运算精度稍差，但是功耗小，成本低
	* 浮点DSP的运算精度高，但是功耗大，成本高

#### (4) SOC：片上系统

* System On Chip，将一个复杂系统集成在一块硅片上
* 如果将设计后的系统下载到FPGA上，就形成了SOC的另一种形式SOPC
* 特点：应用系统集成度高，技术保密性强，功耗低，工作可靠

### 3、嵌入式系统软件

* 分为嵌入式操作系统和嵌入式应用软件
	* 嵌入式操作系统
		* **实时性**：在规定的时间内准确地完成应该执行地操作
		* **可靠性**：也称为可依赖性或者可信任性
		* **可裁剪**：可根据需求进行功能模块配置
	* 应用软件
		* 围绕特定应用需求开发，许多简单应用无需操作系统
		* 复杂应用软件需要嵌入式操作系统支持
		* 逻辑准确、时间确定、运行可靠、减少硬件资源开销