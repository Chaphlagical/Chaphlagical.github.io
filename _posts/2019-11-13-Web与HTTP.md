---
title: Web与HTTP
tags: 计算机网络
article_header:
  type: cover
  image:
    src: /assets/images/computer_network.jpg
---

<!--more-->

## 一、HTTP概况

### (一) Web术语

* Web页：由一些对象组成  

* 对象可以是HTML文件、JPEG图像、Java小程序、声音剪辑文件等  

* Web页含有一个基本的HTML文件，该基本HTML文件又包含若干对象的引用（链接）  

* HTML基本文件通过对象的URL地址引用页面中的其他对象

  * 访问协议，用户名，口令字，端口等

* URL格式：

  ![](/assets/images/computer_network/application_layer/http/1.png)

### (二) HTTP简介

#### 1、HTTP：超文本传输协议

* Web的应用层协议

* 客户/服务器模式

  * 客户：请求、接收和显示Web对象的浏览器
  * 服务器：对请求进行响应，发送对象的Web服务器  

* HTTP 1.0: RFC 1945

  HTTP 1.1: RFC 2068  

![](/assets/images/computer_network/application_layer/http/2.png)

#### 2、HTTP与TCP

HTTP使用TCP作为它的支撑运输协议

##### (1) 使用TCP：

* 客户发起一个与服务器的TCP连接 (建立套接字)，端口号为 80  
* 服务器接收客户的TCP连接
* 在浏览器（HTTP客户端）与Web服务器（HTTP服务器 server）交换HTTP报文 (应用层协议报文)  
* TCP连接关闭

##### (2) HTTP是无状态的

服务器不维护关于客户的任何信息

## 二、HTTP连接

### (一) 非持久HTTP

#### 1、特点

* 最多只有一个对象在TCP连接上发送
* 下载多个对象需要多个TCP连接
* HTTP/1.0使用非持久连接  

#### 2、连接过程

![](/assets/images/computer_network/application_layer/http/3.png)

![](/assets/images/computer_network/application_layer/http/4.png)

#### 3、响应时间模型

![](/assets/images/computer_network/application_layer/http/5.png)

* 一个RTT用来发起TCP连接
* 一个 RTT用来HTTP请求并等待HTTP响应
* 文件传输时间=2RTT+传输时间  

#### 4、缺点

* 每个对象要2个 RTT
* 操作系统必须为每个TCP连接分配资源
* 浏览器通常打开并行TCP连接，以获取引用对象  

### (二) 持久HTTP

#### 1、特点

* 服务器在发送响应后，仍保持TCP连接
* 在相同客户端和服务器之间的后续请求和响应报文通过相同的连接进行传送
* 客户端在遇到一个引用对象的时候，就可以尽快发送该对象的请求  

#### 2、类型

##### (1) 非流水式的持久HTTP

* 客户端只能在收到前一个响应后才能发出新的请求
* 每个引用对象花费一个RTT  

##### (2) 流水方式的持久HTTP

* HTTP/1.1的默认模式
* 客户端遇到一个引用对象就立即产生一个请求
* 所有引用（小）对象只花费一个RTT是可能的  

## 三、HTTP报文

HTTP规范[RFC 1945；RFC 2616；RFC 7540]

### (一) HTTP请求报文

![](/assets/images/computer_network/application_layer/http/6.png)

![](/assets/images/computer_network/application_layer/http/7.png)

* 由ASCII码文本书写

* **基本结构**：

  请求行―首部行―换行回车符（报文结束）

* **请求行**：方法字段―URL字段―HTTP版本字段

* **方法字段**：GET、POST、HEAD(HTTP/1.0)、PUT、DELETE(HTTP/1.1)

  * GET：浏览器请求一个对象时用GET方法，在URL字段带有请求对象的标识
  * POST：用户提交表单，包含在实体主体中的输入被提交到服务器
  * HEAD：服务器用一个HTTP报文进行响应但不返回请求对象――故障跟踪
  * PUT：将实体主体中的文件上载到URL字段规定的路径
  * DELETE：删除URL字段规定的文件

* **通用格式**：

  ![](/assets/images/computer_network/application_layer/http/8.png)

### (二) HTTP响应报文

![](/assets/images/computer_network/application_layer/http/9.png)

![](/assets/images/computer_network/application_layer/http/10.png)

* 基本结构：初始状态行―首部行―实体体（数据）

* 状态行：协议版本字段、状态码、相应状态信息

* 响应状态码：

  * 200 OK
    * 请求成功，请求对象包含在响应报文的后续部分  
  * 301 Moved Permanently  
    * 请求的对象已经被永久转移了；新的URL在响应报文的Location:首部行中指定
    * 客户端软件自动用新的URL去获取对象  
  * 400 Bad Request 
    * 一个通用的差错代码，表示该请求不能被服务器解读  

  * 404 Not Found  
    * 请求的文档在该服务上没有找到  
  * 505 HTTP Version Not Supported  

* 通用格式

  ![](/assets/images/computer_network/application_layer/http/11.png)

## 四、用户-服务器状态：cookies

### (一) 基本组件

* 在HTTP响应报文中有一个cookie的首部行
* 在HTTP请求报文含有一个cookie的首部行
* 在用户端系统中保留有一个cookie文件，由用
  户的浏览器管理
* 在Web站点有一个后端数据库  

### (二) 跟踪维护状态过程

![](/assets/images/computer_network/application_layer/http/12.png)

* **协议端节点**：在多个事务上，发送端和接收端维持状态
* **cookies**: http报文携带状态信息  

### (三) 作用

* 用户验证
* 购物车
* 推荐
* 用户状态

## 五、Web缓存（代理服务器）

### (一) 目的

不访问原始服务器，就满足客户的请求  

### (二) 原理

* 用户设置浏览器： 通过缓存访问Web  
* 浏览器将所有的HTTP请求发给缓存
* 在缓存中的对象：缓存直接返回对象
* 如对象不在缓存，缓存请求原始服务器，然后再将对象返回给客户端  

![](/assets/images/computer_network/application_layer/http/13.png)

### (三) 特点

* 缓存既是客户端又是服务器
* 通常缓存是由ISP安装 (大学、公司、居民区ISP)  

### (四) 意义

* 降低客户端的请求响应时间
* 可以大大减少一个机构内部网络与Internent接入链路上的流量
* 互联网大量采用了缓存：可以使较弱的ICP也能够有效提供内容  

### (五) 示例

![](/assets/images/computer_network/application_layer/http/14.png)

![](/assets/images/computer_network/application_layer/http/15.png)

![](/assets/images/computer_network/application_layer/http/16.png)

## 六、条件GET方法

![](/assets/images/computer_network/application_layer/http/17.png)

* **目标**：如果缓存器中的对象拷贝是最新的，就不要发送对象

* **缓存器**:在HTTP请求中指定缓存拷贝的日期

  If-modified-since:
  <date>

* **服务器**:如果缓存拷贝陈旧，则响应报文没包含对象:
  HTTP/1.0 304 Not
  Modified  