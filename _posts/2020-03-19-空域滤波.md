---
title: 空域滤波
tags: 数字图像处理
article_header:
  type: cover
  image:
    src: /assets/images/DIP.jpg
---

<!--more-->

## 空域滤波

**空域滤波和空域滤波器的定义：**

使用空域模板进行的图像处理，被称为空域滤波。模板本身被称为空域滤波器。

**空域模板：**

空域模板是一个系数矩阵，也可看作是一副 子图像。它是图像空域运算的基本处理单元，也被称之为核函数或滤波器

在$M\times N$的图像$f$上，使用$m\times n$的滤波器：
$$
g(x,y)=\sum\limits^a_{s=-a}\sum\limits^b_{t=-b}w(s,t)f(x+s,y+t),m=2a+1,n=2b+1
$$
空间滤波的简化形式：
$$
R=w_1z_1+w_2z_2+\cdots+w_{mn}z_{mn}
$$
其中，$w$是滤波器系数，$z$是与该系数对应的图像灰度值，$mn$为滤波器中包含的像素点总数

在空域滤波功能都是利用模板运算，主要步骤为：

* 将模板在图中漫游，并将模板中心与图中某个像素位置重合
* 将模板上系数与模板下对应像素相乘
* 将所有乘积相加
* 将和（模板的输出响应）赋给图中对应模板中心位置的像素

## 线性空域滤波

<img src="/assets/images/空域滤波.assets/image-20200318224913812.png" alt="image-20200318224913812" style="zoom: 67%;" />

<img src="/assets/images/空域滤波.assets/image-20200318224943556.png" alt="image-20200318224943556" style="zoom:67%;" />

滤波器的输出是：将模板系数与对应像素相乘，之后再求和。类似于加权求和

线性空域滤波的数学表达式为：
$$
g(x,y)=\sum\limits_{s=-a}^a\sum\limits_{t=-b}^bw(s,t)f(x+s,y+t)
$$
<img src="/assets/images/空域滤波.assets/image-20200318225219702.png" alt="image-20200318225219702" style="zoom:67%;" />

## 图像卷积

三种计算图像滤波的方法**:**

* 模板运算
* 平移+求积+叠加
* 频域运算

## 非线性空域滤波

* 非线性空域滤波也是作用在图像邻域上，采用滑窗式的模板运算，将运算输出赋给处理像素
* 但是其运算并不是基于线性计算，而通常是基于启发式的规则，例如对于邻域范围内的像素进行排序等

## 平滑空域滤波

**作用：**

* 模糊处理:去除图像中一些不重要的细节
* 减小噪声。

**平滑空间滤波器的分类**

* 线性平滑滤波器：如均值滤波器
* 非线性平滑滤波器：
	* 如最大值滤波器
	* 中值滤波器
	* 最小值滤波器

## 线性平滑空域滤波

* 也被称作邻域平均法，输出包含在滤波器邻域内像素的加权平均值
* 作用
	* 减小图像灰度的“尖锐”变化，减小噪声
	* 由于图像边缘是由图像灰度尖锐变化引起的，所以也存在边缘模糊的问题

### 图像噪声

<img src="/assets/images/空域滤波.assets/image-20200318225845666.png" alt="image-20200318225845666" style="zoom:67%;" />

### 邻域平均法

<img src="/assets/images/空域滤波.assets/image-20200318225934728.png" alt="image-20200318225934728" style="zoom:67%;" />

现象：邻域平均法在去除噪声的同时，也可造成图像边缘等细节的模糊。而且，这种模糊效应将随所取模板尺寸的增大而愈趋严重

抑制模糊的对策：合理选择模板的尺寸。为避免处理结果过于模糊的情况发生，应选择尺寸相对小一点的模板

### 加权领域法

<img src="/assets/images/空域滤波.assets/image-20200318230037444.png" alt="image-20200318230037444" style="zoom: 67%;" />

现象：在模板尺寸相同的情况下，选择不同的权值矩阵所造成的模糊程度也有差异。此时，模糊效应将随邻域半径的增大而愈趋严重

抑制模糊的对策：合理选择各模板元素的权值。例如，使模板中心元素和距离中心较近的元素具有相对大的权值以突出待处理像素点、尽量抑制由平滑化处理引入的模糊

### 多模板对策

<img src="/assets/images/空域滤波.assets/image-20200318230143022.png" alt="image-20200318230143022" style="zoom:67%;" />

抑制模糊的对策：使用多模板技术，根据对当前点是否为噪声点的检测结果，选择使用具有不同权值的模板完成计算

**是否孤立噪声点的检测：**

对$f(i,j)$，若
$$
\Bigg|f(i,j)-\frac{1}{N}\sum\limits_{(m,n)\in T}f(m,n) \Bigg|>Th
$$
则判$f(i,j)$为噪声点，否则判为非噪声点

依据：孤立噪声点的灰度值与邻域平均灰度值相差悬殊

**是否孤立噪声点的改进检测：**

以待处理像素为中心，设置9个邻域模式。对每一种邻域模式$k$，分别计算邻域内元素的均值$m_k$和方差$\sigma_k$，$k=1,2,\cdots,9$

噪声点判决规则如下：当
$$
\sigma_k=\min_{l}\{\sigma_l\}>Th
$$
时，待处理像素点为噪声点

## 统计排序滤波器

**定义：**

是一种非线性滤波器，基于滤波器所在图像区域中像素的排序，由排序结果决定的值代替中心像素的值

**分类：**

* 中值滤波器： 用像素领域内的中间值代替该像素
	* 主要用途：去除噪声
	* 计算公式：$R=\mathrm{mid}\{z_k|k-1,2,\cdots,n\}$
* 最大值滤波器：用像素领域内的最大值代替该像素
	* 主要用途：寻找最亮点
	* 计算公式：$R=\max\{z_k|k-1,2,\cdots,n\}$

* 最小值滤波器：用像素领域内的最小值代替该像素
	* 主要用途：寻找最暗点
	* 计算公式：$R=\min\{z_k|k=1,2,\cdots,n\}$

## 中值滤波器

* 用模板区域内像素的中间值，作为结果值

* $R=\mathrm{mid}\{z_k|k-1,2,\cdots,n\}$

* 强迫突出的亮点或暗点更象它周围的值，以消除孤立的亮点或暗点

**一维滤波结果：**

<img src="/assets/images/空域滤波.assets/image-20200318231352856.png" alt="image-20200318231352856" style="zoom: 67%;" />

**二维滤波结果：**

<img src="/assets/images/空域滤波.assets/image-20200318231424824.png" alt="image-20200318231424824" style="zoom:50%;" />![image-20200318231440144](/assets/images/空域滤波.assets/image-20200318231440144.png)

![image-20200318231440144](/assets/images/空域滤波.assets/image-20200318231440144.png)

**特点：**

* 在去除噪音的同时，可以比较好地保留边的锐度和图像的细节（优于均值滤波器）

* 能够有效去除脉冲噪声：以黑白点（椒盐噪声）叠加在图像上中

## 最大值滤波器

<img src="/assets/images/空域滤波.assets/image-20200318231552047.png" alt="image-20200318231552047" style="zoom:50%;" />

## 最小值滤波器

<img src="/assets/images/空域滤波.assets/image-20200318231605150.png" alt="image-20200318231605150" style="zoom:50%;" />

## 锐化空间滤波器

主要用于增强图像的边缘及灰度跳变部分

**边缘提取：**

* 邻域平均方法－积分过程－结果使图像的边缘模糊

* 锐化方法－微分过程－结果使图像的边缘突出

### 边缘检测

**图像边缘：**图像灰度发生跳变的场所

**图像边缘检测：** 在灰度图像的情况下，基于图像像素的灰度值在空间的不连续性对图像作出的一种分割

**图像边缘的描述：**

* 方向：沿边缘走向方向其幅度值变化较平缓

* 幅度：而沿垂直于边缘走向方向其幅度值变化较剧烈 

**灰度截面与图像边缘**

<img src="/assets/images/空域滤波.assets/image-20200318231908331.png" alt="image-20200318231908331" style="zoom:67%;" />

**判据1**

在边缘处，图像的一阶导数的幅度值较大，并在其附近形成一个峰值。其峰值的大小和极性反映了边缘点的强度和方向

**判据2：**

图像的二阶导数在边缘处取零值，并且，在该零值的左右两侧分别存在极性相反的两个波峰；其波峰的大小和走向反映了边缘点的强度和方向

#### 一阶微分算子

如果沿垂直于某个边缘走向方向求图像的一阶微分，则在相应的边缘点处，其微分的幅度值将较大；而在其它的图像点处，其微分的幅度值则取较小的值。这样，通过将各点处图像的一阶微分的幅度值同事先设定的阈值进行比较，可以很容易根据边缘检测的判据1判定该点是不是一个边缘点

**常用的一阶微分运算：**

<img src="/assets/images/空域滤波.assets/image-20200318232108078.png" alt="image-20200318232108078" style="zoom: 67%;" />

**其他常用的微分算子：**

一阶差分运算因使用的数据少，对噪声比较敏感。为了克服这个缺点、提高算子本身的抗干扰能力，可以考虑使用较大尺寸的模板

<img src="/assets/images/空域滤波.assets/image-20200318232154871.png" alt="image-20200318232154871" style="zoom: 80%;" />

**关于差分运算的一些结论：**

* 差分运算（也即微分运算）是一种有方向性的运算， 其运算结果与所取的具体差分方向有关
* 为了获得好的边缘检测性能，要求所进行差分运算的差分方向与边缘方向保持垂直
* 为了检测出图像上所有的边缘点，必须沿不同方向进行相应的差分运算，并选择差分输出的绝对值大于给定阈值的点作为边缘点
* 为了克服一阶差分算子存在的缺点，希望能找到一种各向同性的运算，并能根据该运算得到图像中的边缘

#### 梯度算子

灰度图像的梯度：
$$
\nabla f(x,y)=\frac{\partial f(x,y)}{\partial x}i+\frac{\partial f(x,y)}{\partial y}j
$$

$$
\begin{cases}
|\nabla f(x,y)|=\sqrt{(\frac{\partial f(x,y)}{\partial x})^2+(\frac{\partial f(x,y)}{\partial y})^2}\\
\theta=\tan^{-1}(\frac{\partial f(x,y)}{\partial y}/\frac{\partial f(x,y)}{\partial x})
\end{cases}
$$

**关于梯度幅度的一些结论：**

* 梯度幅度是一个各向同性的微分算子
* 梯度幅度等于$f(x,y)$沿梯度方向上的最大变化率

对于数字图像，可用一阶差分运算代替相应的一阶微分运算。设沿水平和垂直两个方向的一阶差分分别由$\Delta u$和$\Delta v$表示，则可以如下定义三种数字梯度幅度
$$
\begin{align}
|\nabla_1f|&=\sqrt{\nabla_uf^2+\nabla_vf^2}\\
|\nabla_2f|&=|\Delta _u f|+|\Delta_vf|\\
|\nabla_3f|&=\max\{|\Delta _u f|,|\Delta _v f|\}
\end{align}
$$
将以上三种数字梯度幅度和各种一阶差分算子进行组合，可得到不同的边缘梯度算子如Sobel算子、Priwitt算子

#### Canny算子

**问题：** 边缘检测思想简单、易行，但在图像中存在噪声的情况下上述简单方法经常遇到困难

**原因：** 图像中通常混有高频噪声。这些高频噪声和边缘类似，均表现为图像灰度发生跳变，导致检测到的边缘点集中包含大量由噪声引起的虚假边缘点

**解决方案：** 平滑滤波+边缘检测

**最佳边缘检测的三个评价指标**

* 好的信噪比：一个好的边缘检测算子将非边缘点判为边缘点，或者反过来将边缘点判为非边缘点的概率要尽可能低
* 好的定位性能：一个好的边缘检测算子检测出的边缘点应尽可能在实际边缘的中心
* 对单一边缘有唯一的响应：一个好的边缘检测算子对图像中的单一边缘产生多个响应的概率要尽可能低

**平滑滤波+边缘检测**

设输入图像为$f(x,y)$，所使用的平滑滤波器为$h(x,y)$，则平滑滤波后的输出图像可表为
$$
s(x,y)=f(x,y)*h(x,y)
$$
计算输出图像的梯度，有：
$$
\begin{align}
\nabla s(x,y)&=\nabla (f(x,y)*h(x,y))=\nabla(\iint f(s,t)h(s-t,y-t)dsdt)\\
&=\iint f(s,t)\nabla h(x-s,y-t)dsdt=f(x,y)*\nabla h(x,y)
\end{align}
$$
计算其幅值，并同事先设定的阈值进行比较，即可得到所求边缘

**存在的问题(1)**

高斯平滑滤波后，边缘变模糊、得到的边缘有一定宽度

对策：非极大点抑制

* 在垂直于边缘的方向（即梯度方向）上，对相邻点的梯度幅度进行比较，仅保留具有较大梯度幅度的点

**存在的问题(2)**

高斯平滑滤波后，剩余噪声（图像的细纹理）、虚假边缘

对策：非极大点抑制后采用双阈值法予以消除

设置两个阈值：$T_1,T_2=2T_1$

采用非极大点抑制后，分别得到两幅边缘图像：$e_1$，$e_2$

其中，$e_1$真边缘较全，但虚假边缘也多；$e_2$虚假边缘少，但真边缘不全，出现断裂现象

以$e_2$图像为基础，寻找连续的图像边缘；当到达连续边缘的端点处时，在$e_1$图像相应点的邻域内寻找可连接的边缘点，直到填满断裂处的间隙为止

#### 二阶微分算子

**拉普拉斯算子**
$$
\nabla^2=\frac{\partial^2}{\partial x^2}+\frac{\partial ^2}{\partial y^2}
$$
**图像的二阶微分**
$$
\nabla^2f(x,y)=\frac{\partial^2 f(x,y)}{\partial x^2}+\frac{\partial^2 f(x,y)}{\partial y^2}
$$
**图像的二阶微分的差分近似**

![image-20200318234531660](/assets/images/空域滤波.assets/image-20200318234531660.png)
$$
\begin{align}
\nabla^2f(i,j)=f(i+1,j)+(i-1,j)+(i,j+1)+(i,j-1)-4(i,j)
\end{align}
$$
**问题：**

由于数字图像的离散特性，使得实际图像边缘处未必出现所期望的零值

**对策：**

可利用边缘点的过零特性，通过检测其两侧的正、负峰值来定出实际的边缘位置，但是处理起来显得较烦琐

**实际做法：**

采用$\nabla f$将的绝对值同给定阈值$T$进行比较的方法定出图像中的边缘点，即把$|\nabla f|>T$的像素看作是边缘点

**代价：**

不得不经常接受双像素宽的边缘。同时由于$|\nabla f|$对孤立噪声点等高频噪声很敏感，使得方法的抗干扰能力较差

**提高拉普拉斯算子抗高频噪声能力的措施：**

在实际进行边缘检测之前，首先对图像进行平滑滤波处理以抑制掉图像中的高频噪声

设输入图像为$f(x,y)$，所使用的平滑滤波器为$h(x,y)$，则输入图像经该平滑滤波器滤波后的输出可表为
$$
s(x,y)=f(x,y)*h(x,y)
$$
从而，
$$
\begin{align}
\nabla^2s(x,y)&=\nabla^2(f(x,y)*h(x,y))=\nabla^2(\iint f(s,t)h(x-s,y-t)dsdt)\\
&=\iint f(s,t)\nabla^2h(x-s,y-t)dsdt=f(x,y)*\nabla^2h(x,y)
\end{align}
$$

#### LOG算子

**平滑滤波器选择原则：**

* 和引入平滑滤波的初衷一致，所选用的平滑滤波函数$h(x,y)$应该能够起到抑制高频噪声的作用**

* 所选用的平滑滤波函数$h(x,y)$应该至少是二次可微的
* 平滑滤波器的滤波功能是可调的，并能保证灰度图像经滤波后均值保持不变

可以证明，平滑滤波函数取高斯函数形式时满足要求
$$
h(x,y)=G(x,y,\sigma)=\frac{1}{2\pi\sigma^2}\exp(-\frac{1}{2\sigma^2}(x^2+y^2))
$$
**LOG算子：**
$$
\nabla^2s(x,y)=f(x,y)*\nabla^2G(x,y,\sigma)
$$
**LOG滤波器的显著特点：**

* 其中的平滑滤波函数$G$具有将图像模糊化的功能，可有效地消除图像中尺度小于空间参数$\sigma$的强度变化

* 由于平滑滤波函数$Ｇ$在空域和空频域都是平滑和定域的，使得出现由它而引入的在原图像中没有的变化的可能性最小
* 由于$\nabla^2$是各向同性的微分算子，用它可避免沿各个方向的方向导数的计算问题，从而可减少计算开销

图像中的边缘点集$E(x,y)$可表示为：
$$
\begin{align}
E(x,y)&=\{(x,y,\sigma)|\nabla^2(f(x,y)*G(x,y,\sigma))=0 \}\\
&=\{(x,y,\sigma)|(f(x,y)*\nabla^2G(x,y,\sigma))=0 \}
\end{align}
$$
$\sigma$是可调因子。选用不同的$\sigma$，可检测图像中以不同尺度出现的强度变化。$\sigma$选得越大，检测到的边缘点越少，定位精度也越差。反之，$\sigma$选得越小，检测到的边缘点越多，定位精度也越高

### 图像锐化

把各种互补的图像增强技术结合起来，实践复杂的增强任务

**举例**：骨骼图像处理

<img src="/assets/images/空域滤波.assets/image-20200319000047691.png" alt="image-20200319000047691" style="zoom: 67%;" />

**目的：**突出骨骼的更多细节

**策略：**先用拉氏算子突出图像中的小细节，然后用梯度法突出其边缘，平滑过的梯度图像用于屏蔽拉氏图像，最后用灰度变换扩展灰度动态范围

![image-20200319000141564](/assets/images/空域滤波.assets/image-20200319000141564.png)