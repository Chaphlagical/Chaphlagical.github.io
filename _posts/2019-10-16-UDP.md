---
title: UDP
tags: 计算机网络
article_header:
  type: cover
  image:
    src: /assets/images/computer_network.jpg
---

<!--more-->

## 无连接的多路复用与多路分解









## UDP的socket编程

### （一）UDP的通信过程

**UDP:在客户端和服务器之间没有连接**

* 没有握手

* 发送端在每一个报文中明确地指定目标的IP地址和端口号
  
* 服务器必须从收到的分组中提取出发送端的IP地址和端口号

**UDP:传送的数据可能乱序也可能丢失**  

### （二）C/S socket交互图示

![](/assets/images/socket/UDP/1.jpg)

### （三）例程

**C语言实现UDP客户端**

```c
/* client.c */
void main(int argc, char *argv[]){
    struct sockaddr_in sad; /* structure to hold an IP address */
    int clientSocket; /* socket descriptor */
    struct hostent *ptrh; /* pointer to a host table entry */
    
    char Sentence[128];
    char modifiedSentence[128];
    
    host = argv[1]; port = atoi(argv[2]);
    
    clientSocket = socket(PF_INET, SOCK_DGRAM, 0);
    /* determine the server's address */
    memset((char *)&sad,0,sizeof(sad)); /* clear sockaddr structure */
    sad.sin_family = AF_INET; /* set family to Internet */
    sad.sin_port = htons((u_short)port);
    ptrh = gethostbyname(host);
    /* Convert host name to IP address */
    memcpy(&sad.sin_addr, ptrh->h_addr, ptrh->h_length);
    
    gets(Sentence);//Get input stream from user
    addr_len =sizeof(struct sockaddr);
    n=sendto(clientSocket, Sentence, strlen(Sentence)+1,
    (struct sockaddr *) &sad, addr_len);//Send line to server
    n=recvfrom(clientSocket, modifiedSentence, sizeof(modifiedSentence),
    (struct sockaddr *) &sad, &addr_len);//Read line from server
    printf("FROM SERVER: %s\n”,modifiedSentence);//Close connection
    close(clientSocket);
}
```

**C语言实现UDP服务器**

```c
/* server.c */
void main(int argc, char *argv[]){
    struct sockaddr_in sad; /* structure to hold an IP address */
    struct sockaddr_in cad;
    int serverSocket; /* socket descriptor */
    struct hostent *ptrh; /* pointer to a host table entry */
    
    char clientSentence[128];
    char capitalizedSentence[128];
    
    port = atoi(argv[1]);
    
    /**Create welcoming socket at port & Bind a local address**/
    serverSocket = socket(PF_INET, SOCK_DGRAM, 0);
    memset((char *)&sad,0,sizeof(sad)); /* clear sockaddr structure */
    sad.sin_family = AF_INET; /* set family to Internet */
    sad.sin_addr.s_addr = INADDR_ANY; /* set the local IP address */
    sad.sin_port = htons((u_short)port);/* set the port number */
    bind(serverSocket, (struct sockaddr *)&sad, sizeof(sad));
    
    while(1) {
        //Receive messages from clients
        n=recvfrom(serverSocket, clientSentence, sizeof(clientSentence), 0
        (struct sockaddr *) &cad, &addr_len );
        /* capitalize Sentence and store the result in capitalizedSentence*/
        //Write out the result to socket
        n=sendto(serverSocket , capitalizedSentence, strlen(capitalizedSentence)+1,
        (struct sockaddr *) &cad, &addr_len);
    }//End of while loop, loop back and wait for another client connection
}
```

