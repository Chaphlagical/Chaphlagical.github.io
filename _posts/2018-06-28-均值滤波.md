---
bg: "MeanFilter.jpg"
layout: post
title:  "均值滤波"
crawlertitle: "均值滤波"
summary: "均值滤波解析"
date:   2018-06-28 20:30:00 +0700
categories: posts
tags: ['数字图像处理']
author: Chaf
---

本文介绍均值滤波算法。

## 一、算术均值滤波器Arithmetic Mean Filter

$\begin{equation} Img'(x,y)=\frac{1}{mn} \sum_{(s,t) \in S} Img(s,t)  \end{equation} $

其中S为操作区域。  
OpenCV中有函数cv::blur可以实现算术均值滤波，原型：  

```c++
void cv::blur(  
  	cv::InputArray  src,  				//Input image
	cv::OutputArray dst,  				//Result image
	cv::Size ksize,						//Kernel size
	cv::Point anchor=cv::Point(-1,-1),  //Location of anchor point
	int borderType=cv::BORDER_DEFAULT   //Border extrapolation to use
);
```

同时OpenCV的盒式滤波cv::boxFilter也可以做到相同的效果，原型：

```c++
void cv::boxFilter(
	cv::InputArray  src,				//Input image
	cv::OutputArray dst,				//Output image
	int	deepth,							//Output depth(e.g.,CV_8U)
	cv::Size ksize,						//Kernel size
	cv::Point achor=cv::Point(-1,-1),	//Location of anchor point
	bool normalize=true,				//If true,divide by box area
	int	borderType=cv::BORDER_DEFAULT 	//Border extrapolation to use
);
```

boxFilter用的卷积核如下：  
$\begin{equation}
A=\frac{1}{a}
\begin{bmatrix}
1&1&1&\dots&1&\\\  
1&1&1&\dots&1&\\\  
\vdots&\vdots&\vdots&\ddots&\vdots\\\\  
1&1&1&\dots&1&
\end{bmatrix}
\end{equation}$


其中,     
$\begin{equation}
a=\begin{cases}Asize.height*Asize.width& \text{normalize=true}\\\  
1&\text{normalize=false}\end{cases}
\end{equation}$
滤波效果如下：  

<figure class="Img">
    <img src="/assets/images/MeanFilter/origin.jpg" title='原图像' width="300"/>
    <img src="/assets/images/MeanFilter/(5,5)boxfilter.jpg" title='5*5均值滤波'  width="300"/>
	<img src="/assets/images/MeanFilter/(20,20)boxfilter.jpg"  title='20*20均值滤波'  width="300"/>
	<img src="/assets/images/MeanFilter/(1,20)boxfilter.jpg"  title='1*20均值滤波'  width="300"/>
	<img src="/assets/images/MeanFilter/(20,1)boxfilter.jpg"  title='20*1均值滤波'  width="300"/>
	<img src="/assets/images/MeanFilter/boxfilter.jpg"  title='2*2未归一化的盒状滤波'  width="300"/>
</figure>  
可以看出，算术均值滤波器能够有效过滤一些细节，但同时也模糊了边缘信息。

## 二、几何均值滤波器Geometric Mean Filter

 $\begin{equation} Img'(x,y)= [ \prod_{(s,t)\in S} Img(s,t)  ] ^\frac{1}{mn} \end{equation}$ 

和算术均值滤波器相比，几何均值滤波器能够更好的过滤高斯噪声，并且能够更多的保留图像的边缘信息。但对0值是非常敏感的，在滤波器的窗口内只要有一个像素的灰度值为0，就会造成滤波器的输出结果为0。

Pyhton实现： 

```python
import numpy as np

def GMF(img,m,n):
    img=img.astype('float64')

    def multiply(a):
        s = 1
        for i in range(a.shape[0]):
            for j in range(a.shape[1]):
                s *= a[i][j]
        return s

    row = img.shape[0]
    col = img.shape[1]
    Img = img.copy()
    img1 = np.zeros((row + 2 * int(m / 2), col + 2 * int(n / 2)))
    img1[int(m / 2):-int(m / 2), int(n / 2):-int(n / 2)] = img
    for i in range(row):
        for j in range(col):
            Img[i][j] = multiply(img1[i:i + m, j:j + n])**(1/(m*n))
    return Img
```

滤波效果：  
<figure class="Img">
    <img src="/assets/images/MeanFilter/origin.jpg" title='原图像'  width="300"/>
	<img src="/assets/images/MeanFilter/(2,2)GMF.jpg"  title='2*2滤波'  width="300"/>
    <img src="/assets/images/MeanFilter/(5,5)GMF.jpg" title='5*5均值滤波'  width="300"/>
	<img src="/assets/images/MeanFilter/(10,10)GMF.jpg" title='10*10均值滤波' width="300"/>
	<img src="/assets/images/MeanFilter/(2,20)GMF.jpg"  title='2*20均值滤波'  width="300"/>
	<img src="/assets/images/MeanFilter/(20,2)GMF.jpg"  title='20*2均值滤波'  width="300"/>
</figure>  



## 三、谐波均值滤波器Harmonic Mean Filter

$\begin{equation} Img'(x,y)=\frac{mn}{\sum_{(s,t)\in S}\frac{1}{Img(s,t)}} \end{equation}  $
谐波均值滤波器对盐粒噪声（白噪声）过滤效果较好，不适用于椒盐噪声，比较适合处理高斯噪声。  

Python实现：  

```python
import numpy as np

def HMF(img,m,n):#谐波均值滤波
    img = img.astype('float64')

    def multi(a):
        s = 0
        for i in range(a.shape[0]):
            for j in range(a.shape[1]):
                s += 1/a[i][j]
        return 1/s

    row = img.shape[0]
    col = img.shape[1]
    Img = img.copy()
    img1 = np.zeros((row + 2 * int(m / 2), col + 2 * int(n / 2)))
    img1[int(m / 2):-int(m / 2), int(n / 2):-int(n / 2)] = img
    for i in range(row):
        for j in range(col):
            Img[i][j] = mutiply(img1[i:i + m, j:j + n])*m*n
    return Img  
```

滤波效果： 
<figure class="Img">
    <img src="/assets/images/MeanFilter/origin.jpg" title='原图像'  width="300"/>
	<img src="/assets/images/MeanFilter/(2,2)HMF.jpg"  title='2*2滤波'  width="300"/>
    <img src="/assets/images/MeanFilter/(5,5)HMF.jpg" title='5*5均值滤波'  width="300"/>
	<img src="/assets/images/MeanFilter/(10,10)HMF.jpg"  title='10*10均值滤波'  width="300"/>
	<img src="/assets/images/MeanFilter/(2,20)HMF.jpg"  title='2*20均值滤波'  width="300"/>
	<img src="/assets/images/MeanFilter/(20,2)HMF.jpg"  title='20*2均值滤波'  width="300"/>
</figure>  

## 四、逆谐波均值滤波器Contra-Harmonic Mean Filter

$\begin{equation} Img'(x,y)=\frac{\sum Img(s,t)^{Q+1}}{\sum Img(s,t)^{Q}} \end{equation}$

$\sum$对所有（s,t）在S区域内的求和,Q为正整数。  
其中Q称为滤波器的阶数，该滤波器可以用来消除椒盐噪声。但是需要不同同时处理盐粒噪声和胡椒噪声，当Q为正时，可以消除胡椒噪声；当Q为负时，消除盐粒噪声。当Q=0时，该滤波器退化为算术均值滤波器；Q=-1时，退化为谐波均值滤波器。

Python实现：  

```python
import numpy as np

def CHMF(img,m,n,Q):
	img = img.astype('float64')

    def multi(a):
        s1 = 0
        s2=0
        for i in range(a.shape[0]):
            for j in range(a.shape[1]):
                s1 +=a[i][j]**Q
                s2+=a[i][j]**(Q+1)
        return s2/s1

    row = img.shape[0]
    col = img.shape[1]
    Img = img.copy()
    img1 = np.zeros((row + 2 * int(m / 2), col + 2 * int(n / 2)))
    img1[int(m / 2):-int(m / 2), int(n / 2):-int(n / 2)] = img
    for i in range(row):
        for j in range(col):
            Img[i][j] = multi(img1[i:i + m, j:j + n])
    return Img
```

滤波效果：
<figure class="Img">
    <img src="/assets/images/MeanFilter/origin.jpg" title='原图像'  width="300"/>
	<img src="/assets/images/MeanFilter/(Q=2&m=n=5)CHMF.jpg"  title='2*2滤波'  width="300"/>
    <img src="/assets/images/MeanFilter/(Q=2&m=n=10)CHMF.jpg" title='5*5均值滤波'  width="300"/>
	<img src="/assets/images/MeanFilter/(Q=6&m=n=5)CHMF.jpg"  title='10*10均值滤波'  width="300"/>
	<img src="/assets/images/MeanFilter/(Q=-2&m=n=5)CHMF.jpg"  title='2*20均值滤波'  width="300"/>
	<img src="/assets/images/MeanFilter/(Q=-6&m=n=5)CHMF.jpg"  title='20*2均值滤波'  width="300"/>
</figure>  

## 五、非线性均值滤波器的推广

非线性均值滤波器定义为：  

$Img'(m,n)=u^{-1}(\frac{\sum a(i,j)u[Img(i,j)]}{\sum a(i,j)}),(i,j) \in O,O为当前像素的一个局部邻域，u(i,j)为可逆的单变量函数，a(i,j)为加权系数$ 

